{% extends "base.html" %} {% block title %}{{ club.name }} - Hack Clubs Dash{%
endblock %} {% block extra_head %}
<link
    rel="stylesheet"
    type="text/css"
    href="{{ url_for('static', filename='css/dash.css') }}"
/>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<style>
    .post-composer-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
    }

    .markdown-toggle {
        display: flex;
        gap: 0.5rem;
    }

    .markdown-preview {
        border: 1px solid #dee2e6;
        border-radius: 0.375rem;
        padding: 0.75rem;
        background: #f8f9fa;
        margin-top: 0.5rem;
        max-height: 300px;
        overflow-y: auto;
    }

    .markdown-preview h1,
    .markdown-preview h2,
    .markdown-preview h3,
    .markdown-preview h4,
    .markdown-preview h5,
    .markdown-preview h6 {
        margin-top: 0;
        margin-bottom: 0.5rem;
    }

    .markdown-preview pre {
        background: #2d3748;
        color: #e2e8f0;
        padding: 1rem;
        border-radius: 0.375rem;
        overflow-x: auto;
    }

    .markdown-preview code {
        background: #e2e8f0;
        padding: 0.2rem 0.4rem;
        border-radius: 0.25rem;
        font-size: 0.875rem;
    }

    .markdown-preview blockquote {
        border-left: 4px solid #3b82f6;
        margin: 0;
        padding-left: 1rem;
        color: #6b7280;
    }

    .post-composer-actions {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 1rem;
    }

    /* Club Background Customization - Simple direct approach */
    .club-dashboard[data-has-background="true"] {
        background-size: cover !important;
        background-position: center !important;
        background-repeat: no-repeat !important;
        background-attachment: fixed !important;
    }

    /* Join Code Modal Styles */
    .join-code-modal .modal-content {
        max-width: 600px;
        text-align: center;
    }

    .join-code-big {
        font-size: 4rem;
        font-weight: 800;
        color: #ec3750;
        background: linear-gradient(135deg, #fef7f7, #fff);
        border: 3px solid #ec3750;
        border-radius: 16px;
        padding: 2rem;
        margin: 2rem 0;
        letter-spacing: 0.2em;
        font-family: 'Courier New', 'Monaco', monospace;
        box-shadow: 0 8px 30px rgba(236, 55, 80, 0.2);
        transition: all 0.3s ease;
    }

    .join-code-big:hover {
        transform: scale(1.02);
        box-shadow: 0 12px 40px rgba(236, 55, 80, 0.3);
    }

    .join-code-display.clickable {
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .join-code-display.clickable:hover {
        background-color: rgba(236, 55, 80, 0.1);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(236, 55, 80, 0.2);
    }

    /* Mobile responsiveness for projector display */
    @media (max-width: 768px) {
        .join-code-big {
            font-size: 2.5rem;
            padding: 1.5rem;
        }
    }

    @media (max-width: 480px) {
        .join-code-big {
            font-size: 2rem;
            padding: 1rem;
            letter-spacing: 0.1em;
        }
    }
</style>
{% endblock %} {% block content %}
<script src="https://server.fillout.com/embed/v1/"></script>
<div
    class="club-dashboard"
    data-club-id="{{ club.id }}"
    data-join-code="{{ club.join_code }}"
    data-user-role="{% if current_user.id == club.leader_id %}leader{% elif is_co_leader %}co-leader{% elif is_admin_access %}admin{% else %}member{% endif %}"
    data-admin-access="{{ 'true' if is_admin_access else 'false' }}"
    {%
    if
    club.background_image_url
    %}
    data-has-background="true"
    data-background-url="{{ club.background_image_url }}"
    data-background-blur="{{ club.background_blur or 0 }}"
    {%
    endif
    %}
>
    <div class="club-header">
        <div class="container">
            <div class="club-info">
                <div class="club-avatar">
                    <i class="fas fa-users"></i>
                </div>
                <div class="club-details">
                    <h1>
                        {{ club.name }} {% if is_admin_access %}<span
                            style="
                                color: #fbbf24;
                                margin-left: 8px;
                                font-size: 0.8em;
                                font-weight: normal;
                            "
                            ><i class="fas fa-shield-alt"></i> Admin View</span
                        >{% endif %}
                    </h1>
                    <div class="club-meta">
                        <span
                            ><i class="fas fa-map-marker-alt"></i> {{
                            club.location or 'No location set' }}</span
                        >
                        <span
                            ><i class="fas fa-calendar"></i> Created {{
                            club.created_at.strftime('%B %Y') }}</span
                        >
                        <span
                            ><i class="fas fa-user-friends"></i> {{
                            club.members|length + 1 }} members</span
                        >
                    </div>
                </div>
                <div class="club-actions">
                    {% if current_user.id == club.leader_id or is_co_leader %}
                    <div
                        class="club-detail-item join-code-display clickable"
                        title="Click to show join code"
                        onclick="showJoinCodeModal()"
                    >
                        <i class="fas fa-key"></i> {{ club.join_code }}
                    </div>
                    {% if economy_enabled %}
                    <div
                        class="club-detail-item balance-display {% if not has_gallery_post %}locked-feature{% endif %}"
                        title="{% if has_gallery_post %}Club Tokens{% else %}Create a gallery post to unlock tokens{% endif %}"
                    >
                        <i
                            class="fas fa-coins{% if not has_gallery_post %} fa-lock{% endif %}"
                        ></i>
                        {% if has_gallery_post %} {{ (club.balance|float *
                        100)|int }} tokens {% else %}
                        <span style="color: white" class="locked-text"
                            >Create a gallery post to unlock</span
                        >
                        {% endif %}
                    </div>
                    {% endif %}
                    <button class="qr-button" onclick="showQRModal()">
                        <i class="fas fa-qrcode"></i> QR Code
                    </button>
                    <button
                        class="new-code-button"
                        onclick="generateNewJoinCode()"
                    >
                        <i class="fas fa-sync-alt"></i> New Code
                    </button>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="dashboard-layout">
            <div class="dashboard-sidebar">
                <nav class="sidebar-nav">
                    <div class="nav-section">
                        <h4 class="nav-section-title">Club Overview</h4>
                        <ul>
                            <li>
                                <a
                                    href="#dashboard"
                                    class="nav-link active"
                                    data-section="dashboard"
                                >
                                    <i class="fas fa-tachometer-alt"></i>
                                    Dashboard
                                </a>
                            </li>
                            <li>
                                <a
                                    href="#members"
                                    class="nav-link"
                                    data-section="members"
                                >
                                    <i class="fas fa-user-friends"></i> Members
                                </a>
                            </li>
                        </ul>
                    </div>

                    <div class="nav-section">
                        <h4 class="nav-section-title">Communication</h4>
                        <ul>
                            <li>
                                <a
                                    href="#chat"
                                    class="nav-link"
                                    data-section="chat"
                                >
                                    <i class="fas fa-comments"></i> Chat
                                </a>
                            </li>
                            <li>
                                <a
                                    href="#stream"
                                    class="nav-link"
                                    data-section="stream"
                                >
                                    <i class="fas fa-bullhorn"></i>
                                    Announcements
                                </a>
                            </li>
                            {% if effective_can_manage %}
                            <li>
                                <a
                                    href="#slack"
                                    class="nav-link"
                                    data-section="slack"
                                >
                                    <i class="fab fa-slack"></i> Slack Channel
                                </a>
                            </li>
                            {% endif %}
                        </ul>
                    </div>

                    <div class="nav-section">
                        <h4 class="nav-section-title">Activities & Events</h4>
                        <ul>
                            <li>
                                <a
                                    href="#attendance"
                                    class="nav-link"
                                    data-section="attendance"
                                >
                                    <i class="fas fa-calendar-check"></i> {% if
                                    current_user.id == club.leader_id or
                                    is_co_leader %}Sessions & Attendance{% else
                                    %}Events{% endif %}
                                </a>
                            </li>
                        </ul>
                    </div>

                    <div class="nav-section">
                        <h4 class="nav-section-title">Projects & Learning</h4>
                        <ul>
                            <li>
                                <a
                                    href="#assignments"
                                    class="nav-link"
                                    data-section="assignments"
                                >
                                    <i class="fas fa-tasks"></i> {% if
                                    current_user.id == club.leader_id or
                                    is_co_leader %}Assignments{% else %}My
                                    Tasks{% endif %}
                                </a>
                            </li>
                            {% if economy_enabled %}
                            <li>
                                <a
                                    href="{{ url_for('project_submission', club_id=club.id) }}"
                                    class="nav-link project-link project-link-highlight"
                                    onclick="window.location.href=this.href; return false;"
                                >
                                    <i class="fas fa-code"></i>
                                    <span>Submit Project</span>
                                </a>
                            </li>
                            {% endif %}
                            <li>
                                <a
                                    href="#resources"
                                    class="nav-link"
                                    data-section="resources"
                                >
                                    <i class="fas fa-book"></i> Resources
                                </a>
                            </li>
                        </ul>
                    </div>

                    <div class="nav-section">
                        <h4 class="nav-section-title">Club Promotion</h4>
                        <ul>
                            <li>
                                <a
                                    href="#advertising"
                                    class="nav-link"
                                    data-section="advertising"
                                >
                                    <i class="fas fa-bullhorn"></i> Advertising
                                </a>
                            </li>
                        </ul>
                    </div>

                    {% if economy_enabled %}
                    <div class="nav-section">
                        <h4 class="nav-section-title">Token Economy</h4>
                        <ul>
                            <li>
                                <a
                                    href="#quests"
                                    class="nav-link"
                                    data-section="quests"
                                >
                                    <i class="fas fa-trophy"></i>
                                    Weekly Quests
                                </a>
                            </li>
                            <li>
                                <a
                                    href="{{ url_for('club_shop', club_id=club.id) }}"
                                    class="nav-link shop-link"
                                    onclick="window.location.href=this.href; return false;"
                                >
                                    <i class="fas fa-shopping-cart"></i>
                                    Token Shop
                                </a>
                            </li>
                            <li>
                                <a
                                    href="#transactions"
                                    class="nav-link"
                                    data-section="transactions"
                                >
                                    <i class="fas fa-coins"></i>
                                    Token {% if effective_can_manage
                                    %}Transactions{% else %}History{% endif %}
                                    <span
                                        id="transactionsNotification"
                                        class="notification-dot"
                                        style="display: none"
                                    ></span>
                                </a>
                            </li>
                            {% if effective_can_manage %}
                            <li>
                                <a
                                    href="#piggy-bank"
                                    class="nav-link"
                                    data-section="piggy-bank"
                                >
                                    <i class="fas fa-piggy-bank"></i>
                                    Piggy Bank
                                </a>
                            </li>
                            {% endif %} {% if has_orders %}
                            <li>
                                <a
                                    href="{{ url_for('club_orders', club_id=club.id) }}"
                                    class="nav-link orders-link"
                                    onclick="window.location.href=this.href; return false;"
                                >
                                    <i class="fas fa-box"></i> My Orders
                                </a>
                            </li>
                            {% endif %}
                        </ul>
                    </div>
                    {% endif %} {% if current_user.id == club.leader_id %}
                    <div class="nav-section">
                        <h4 class="nav-section-title">Administration</h4>
                        <ul>
                            <li>
                                <a
                                    href="#settings"
                                    class="nav-link"
                                    data-section="settings"
                                >
                                    <i class="fas fa-cogs"></i> Settings
                                </a>
                            </li>
                        </ul>
                    </div>
                    {% endif %}
                </nav>
            </div>

            <div class="dashboard-main">
                <section id="dashboard" class="club-section active fade-in">
                    <!-- Gallery Post Required Banner -->
                    {% if economy_enabled and current_user.id == club.leader_id
                    and not has_gallery_post %}
                    <div class="alert-card">
                        <div class="alert-icon">
                            <i class="fas fa-camera"></i>
                        </div>
                        <div class="alert-content">
                            <h4>
                                Make a gallery post to start earning/spending
                                tokens!
                            </h4>
                            <p>
                                Create your first gallery post to unlock the
                                token system and start earning rewards for your
                                club activities.
                            </p>
                            <a
                                href="{{ url_for('gallery') }}"
                                class="alert-btn"
                            >
                                <i class="fas fa-plus"></i> Create Gallery Post
                            </a>
                        </div>
                    </div>
                    {% endif %} {% if banner_settings.enabled %}
                    <div
                        class="promotional-banner"
                        style="
                        background: {{ banner_settings.background_color }};
                        border: 1px solid #e2e8f0;
                        border-radius: 16px;
                        padding: 1.5rem;
                        margin-bottom: 2rem;
                        display: flex;
                        align-items: center;
                        justify-content: space-between;
                        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
                        color: {{ banner_settings.text_color }};
                    "
                    >
                        <div
                            style="
                                display: flex;
                                align-items: center;
                                gap: 1rem;
                            "
                        >
                            <div
                                style="
                                width: 50px;
                                height: 50px;
                                background: linear-gradient(135deg, {{ banner_settings.primary_color }}, {{ banner_settings.secondary_color }});
                                border-radius: 12px;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                color: white;
                                font-size: 1.25rem;
                            "
                            >
                                <i class="{{ banner_settings.icon }}"></i>
                            </div>
                            <div>
                                <h3
                                    style="margin: 0; font-size: 1.1rem; font-weight: 700; color: {{ banner_settings.text_color }};"
                                >
                                    {{ banner_settings.title }}
                                </h3>
                                <p
                                    style="margin: 0.25rem 0 0 0; font-size: 0.9rem; color: {{ banner_settings.text_color }}; opacity: 0.8;"
                                >
                                    {{ banner_settings.subtitle }}
                                </p>
                            </div>
                        </div>
                        <a
                            href="{{ banner_settings.link_url }}"
                            style="
                            background: linear-gradient(135deg, {{ banner_settings.primary_color }}, {{ banner_settings.secondary_color }});
                            color: white;
                            text-decoration: none;
                            padding: 0.75rem 1.5rem;
                            border-radius: 8px;
                            font-weight: 600;
                            display: flex;
                            align-items: center;
                            gap: 0.5rem;
                            transition: transform 0.2s ease;
                        "
                            onmouseover="this.style.transform='translateY(-2px)'"
                            onmouseout="this.style.transform='translateY(0)'"
                        >
                            <i class="fas fa-arrow-right"></i>
                            {{ banner_settings.link_text }}
                        </a>
                    </div>
                    {% endif %}

                    <div class="section-header" style="position: relative">
                        <h2>
                            <i class="fas fa-tachometer-alt"></i> {% if
                            current_user.id == club.leader_id or current_user.id
                            == club.co_leader_id %}Dashboard{% else %}Welcome
                            Back!{% endif %}
                        </h2>
                        <p>
                            {% if current_user.id == club.leader_id or
                            is_co_leader %}Welcome to {{ club.name }}{% else
                            %}Here's what's happening in {{ club.name }}{% endif
                            %}
                        </p>
                    </div>

                    {% if not club.get_airtable_data() or not
                    club.get_airtable_data().get('airtable_id') %}
                    <div
                        style="
                            background: #fef3c7;
                            border: 1px solid #f59e0b;
                            border-radius: 12px;
                            padding: 1.5rem;
                            margin-bottom: 2rem;
                        "
                    >
                        <div
                            style="
                                display: flex;
                                align-items: flex-start;
                                gap: 1rem;
                            "
                        >
                            <div
                                style="
                                    color: #92400e;
                                    font-size: 1.5rem;
                                    flex-shrink: 0;
                                "
                            >
                                <i class="fas fa-exclamation-triangle"></i>
                            </div>
                            <div>
                                <h4
                                    style="
                                        color: #92400e;
                                        margin: 0 0 0.5rem 0;
                                        font-size: 1.1rem;
                                    "
                                >
                                    Club Not Connected to Hack Club Directory
                                </h4>
                                <p
                                    style="
                                        color: #92400e;
                                        margin: 0 0 1rem 0;
                                        font-size: 0.9rem;
                                    "
                                >
                                    This club is not connected to the official
                                    Hack Club directory. To access full features
                                    and sync with official club data, you need
                                    to verify and connect your club.
                                </p>
                                {% if current_user.id == club.leader_id %}
                                <a
                                    href="{{ url_for('verify_leader') }}"
                                    style="
                                        background: #ec3750;
                                        color: white;
                                        padding: 0.5rem 1rem;
                                        border-radius: 6px;
                                        text-decoration: none;
                                        font-weight: 600;
                                        font-size: 0.85rem;
                                        display: inline-flex;
                                        align-items: center;
                                        gap: 0.5rem;
                                    "
                                >
                                    <i class="fas fa-link"></i> Connect to
                                    Official Club
                                </a>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    {% endif %}

                    <div
                        class="quick-actions-section"
                        style="margin-bottom: 2rem"
                    >
                        <div
                            style="
                                display: flex;
                                gap: 1rem;
                                flex-wrap: wrap;
                                justify-content: center;
                            "
                        >
                            {% if economy_enabled %}
                            <a
                                href="{{ url_for('club_shop', club_id=club.id) }}"
                                class="btn btn-primary"
                                style="
                                    display: flex;
                                    align-items: center;
                                    gap: 0.5rem;
                                    padding: 0.75rem 1.5rem;
                                    text-decoration: none;
                                "
                            >
                                <i class="fas fa-shopping-cart"></i>
                                Club Shop
                            </a>
                            <a
                                href="{{ url_for('project_submission', club_id=club.id) }}"
                                class="btn btn-secondary"
                                style="
                                    display: flex;
                                    align-items: center;
                                    gap: 0.5rem;
                                    padding: 0.75rem 1.5rem;
                                    text-decoration: none;
                                "
                            >
                                <i class="fas fa-code"></i>
                                Submit Project
                            </a>
                            {% endif %}
                        </div>
                    </div>

                    <div class="dashboard-cards">
                        {% if effective_can_manage %}
                        <!-- Leader/Co-leader Dashboard Cards -->
                        <div class="dashboard-card">
                            <div class="dashboard-card-header">
                                <div class="card-icon members">
                                    <i class="fas fa-users"></i>
                                </div>
                                <div class="card-content">
                                    <h3>Club Members</h3>
                                    <div class="card-metric">
                                        {{ club.members|length + 1 }}
                                    </div>
                                    <p>Total members</p>
                                </div>
                            </div>
                            <div class="dashboard-card-actions">
                                <a
                                    href="#members"
                                    class="btn btn-primary btn-sm"
                                    onclick="openTab('members')"
                                >
                                    <i class="fas fa-eye"></i> View Members
                                </a>
                            </div>
                        </div>

                        <div class="dashboard-card">
                            <div class="dashboard-card-header">
                                <div class="card-icon meetings">
                                    <i class="fas fa-calendar-alt"></i>
                                </div>
                                <div class="card-content">
                                    <h3>Meetings</h3>
                                    <div class="card-metric" id="meetingsCount">
                                        0
                                    </div>
                                    <p>Scheduled this month</p>
                                </div>
                            </div>
                            <div class="dashboard-card-actions">
                                <a
                                    href="#schedule"
                                    class="btn btn-primary btn-sm"
                                    onclick="openTab('schedule')"
                                >
                                    <i class="fas fa-plus"></i> Schedule Meeting
                                </a>
                            </div>
                        </div>

                        <div class="dashboard-card">
                            <div class="dashboard-card-header">
                                <div class="card-icon assignments">
                                    <i class="fas fa-tasks"></i>
                                </div>
                                <div class="card-content">
                                    <h3>Assignments</h3>
                                    <div
                                        class="card-metric"
                                        id="assignmentsCount"
                                    >
                                        0
                                    </div>
                                    <p>Active assignments</p>
                                </div>
                            </div>
                            <div class="dashboard-card-actions">
                                <a
                                    href="#assignments"
                                    class="btn btn-primary btn-sm"
                                    onclick="openTab('assignments')"
                                >
                                    <i class="fas fa-plus"></i> Create
                                    Assignment
                                </a>
                            </div>
                        </div>

                        {% else %}
                        <!-- Member Dashboard Cards -->
                        <div class="dashboard-card">
                            <div class="dashboard-card-header">
                                <div class="card-icon assignments">
                                    <i class="fas fa-tasks"></i>
                                </div>
                                <div class="card-content">
                                    <h3>My Tasks</h3>
                                    <div
                                        class="card-metric"
                                        id="myAssignmentsCount"
                                    >
                                        0
                                    </div>
                                    <p>Active assignments</p>
                                </div>
                            </div>
                            <div class="dashboard-card-actions">
                                <a
                                    href="#assignments"
                                    class="btn btn-primary btn-sm"
                                    onclick="openTab('assignments')"
                                >
                                    <i class="fas fa-eye"></i> View Tasks
                                </a>
                            </div>
                        </div>

                        <div class="dashboard-card">
                            <div class="dashboard-card-header">
                                <div class="card-icon meetings">
                                    <i class="fas fa-calendar-alt"></i>
                                </div>
                                <div class="card-content">
                                    <h3>Upcoming Events</h3>
                                    <div
                                        class="card-metric"
                                        id="upcomingEventsCount"
                                    >
                                        0
                                    </div>
                                    <p>This month</p>
                                </div>
                            </div>
                            <div class="dashboard-card-actions">
                                <a
                                    href="#schedule"
                                    class="btn btn-primary btn-sm"
                                    onclick="openTab('schedule')"
                                >
                                    <i class="fas fa-calendar"></i> View Events
                                </a>
                            </div>
                        </div>

                        {% endif %}
                    </div>
                </section>

                <section id="stream" class="club-section fade-in">
                    <div class="section-header">
                        <h2><i class="fas fa-stream"></i> Stream</h2>
                        <p>Club announcements and updates</p>
                    </div>

                    {% if effective_can_manage %}
                    <div class="post-composer">
                        <div class="post-composer-header">
                            <h3>
                                <i class="fas fa-pen"></i> Create Announcement
                            </h3>
                            <div class="markdown-toggle">
                                <button
                                    type="button"
                                    class="btn btn-sm btn-outline-secondary"
                                    id="markdownPreviewBtn"
                                    onclick="toggleMarkdownPreview()"
                                >
                                    <i class="fas fa-eye"></i> Preview
                                </button>
                                <button
                                    type="button"
                                    class="btn btn-sm btn-outline-info"
                                    onclick="showMarkdownHelp()"
                                >
                                    <i class="fas fa-question-circle"></i>
                                    Markdown Help
                                </button>
                            </div>
                        </div>
                        <div class="post-composer-body">
                            <div class="markdown-editor">
                                <textarea
                                    id="postContent"
                                    placeholder="Write your announcement in **Markdown**! 

## Features you can use:
- **Bold text** with **asterisks**
- *Italic text* with *single asterisks*
- `Code snippets` with backticks
- [Links](https://example.com)
- > Blockquotes
- - Bullet lists
- 1. Numbered lists

```javascript
// Code blocks with syntax highlighting
console.log('Hello, world!');
```"
                                    style="
                                        min-height: 150px;
                                        font-family:
                                            &quot;Courier New&quot;,
                                            monospace;
                                    "
                                ></textarea>
                                <div
                                    id="markdownPreview"
                                    class="markdown-preview"
                                    style="
                                        display: none;
                                        min-height: 150px;
                                        border: 1px solid #dee2e6;
                                        border-radius: 0.375rem;
                                        padding: 0.75rem;
                                        background: #f8f9fa;
                                        margin-top: 0.5rem;
                                    "
                                >
                                    <em>Preview will appear here...</em>
                                </div>
                            </div>
                            <div class="post-composer-actions">
                                <small
                                    class="text-muted"
                                    style="margin-right: auto"
                                >
                                    <i class="fab fa-markdown"></i> Markdown
                                    supported
                                </small>
                                <button
                                    class="btn btn-primary"
                                    onclick="createPost()"
                                >
                                    <i class="fas fa-paper-plane"></i> Post
                                </button>
                            </div>
                        </div>
                    </div>
                    {% endif %}

                    <div class="posts-list" id="postsList">
                        <div class="empty-state">
                            <i class="fas fa-stream"></i>
                            <h3>No posts yet</h3>
                            <p>
                                Be the first to share something with your club!
                            </p>
                        </div>
                    </div>
                </section>

                <section id="assignments" class="club-section fade-in">
                    <div class="content-header">
                        <div>
                            <h2>
                                <i class="fas fa-tasks"></i> {% if
                                current_user.id == club.leader_id or
                                is_co_leader %}Assignments{% else %}My
                                Assignments{% endif %}
                            </h2>
                            <p>
                                {% if current_user.id == club.leader_id or
                                is_co_leader %}Coding challenges and tasks for
                                club members{% else %}Complete these coding
                                challenges and tasks{% endif %}
                            </p>
                        </div>
                        {% if effective_can_manage %}
                        <button
                            class="btn btn-primary"
                            onclick="openCreateAssignmentModal()"
                        >
                            <i class="fas fa-plus"></i> New Assignment
                        </button>
                        {% endif %}
                    </div>

                    <div id="assignmentsList">
                        <div class="empty-state">
                            <i class="fas fa-clipboard-list"></i>
                            <h3>No assignments yet</h3>
                            <p>
                                {% if current_user.id == club.leader_id or
                                is_co_leader %}Create your first assignment to
                                get started!{% else %}Your leaders will assign
                                coding challenges soon!{% endif %}
                            </p>
                        </div>
                    </div>
                </section>

                <section id="attendance" class="club-section fade-in">
                    <div class="content-header">
                        <div>
                            <h2>
                                <i class="fas fa-calendar-check"></i> {% if
                                current_user.id == club.leader_id or
                                is_co_leader %}Sessions & Attendance{% else
                                %}Club Events{% endif %}
                            </h2>
                            <p>
                                {% if current_user.id == club.leader_id or
                                is_co_leader %}Manage club sessions, track
                                attendance, and view analytics{% else %}View
                                upcoming events and your attendance history{%
                                endif %}
                            </p>
                        </div>
                        {% if current_user.id == club.leader_id or is_co_leader
                        %}
                        <div class="header-actions">
                            <button
                                class="btn btn-primary"
                                onclick="openCreateSessionModal()"
                            >
                                <i class="fas fa-calendar-plus"></i> Schedule
                                Meeting
                            </button>
                            <button
                                class="btn btn-secondary"
                                onclick="showAttendanceReports()"
                            >
                                <i class="fas fa-chart-bar"></i> Reports
                            </button>
                        </div>
                        {% endif %}
                    </div>

                    <!-- Session Calendar -->
                    <div class="attendance-calendar-container">
                        <div class="calendar-header">
                            <button
                                class="btn-calendar-nav"
                                onclick="changeMonth(-1)"
                            >
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <h3 id="calendar-month-year"></h3>
                            <button
                                class="btn-calendar-nav"
                                onclick="changeMonth(1)"
                            >
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                        <div class="calendar-grid" id="attendance-calendar">
                            <!-- Calendar will be populated by JavaScript -->
                        </div>
                    </div>

                    <!-- Session List -->
                    <div class="sessions-container">
                        <div class="sessions-header">
                            <h3>Upcoming Sessions</h3>
                            <div class="session-filters">
                                <select
                                    id="session-type-filter"
                                    onchange="filterSessions()"
                                >
                                    <option value="">All Types</option>
                                    <option value="meeting">Meeting</option>
                                    <option value="workshop">Workshop</option>
                                    <option value="event">Event</option>
                                    <option value="hackathon">Hackathon</option>
                                </select>
                                <input
                                    type="date"
                                    id="session-date-filter"
                                    onchange="filterSessions()"
                                />
                            </div>
                        </div>
                        <div class="sessions-list" id="sessions-list">
                            <!-- Sessions will be populated by JavaScript -->
                        </div>
                    </div>

                    <!-- Simplified Sessions - Complex attendance panel removed -->
                </section>

                <section id="members" class="club-section fade-in">
                    <div class="content-header">
                        <div>
                            <h2><i class="fas fa-user-friends"></i> Members</h2>
                            <p>Manage your club members</p>
                        </div>
                    </div>

                    <div
                        class="members-search-container"
                        style="
                            margin-bottom: 2rem;
                            display: flex;
                            justify-content: center;
                        "
                    >
                        <div class="form-group">
                            <input
                                type="text"
                                id="membersSearchInput"
                                class="form-control"
                                placeholder="Search members by name or email..."
                            />
                        </div>
                    </div>

                    <div class="members-list">
                        <!-- Leader Card -->
                        <div class="member-card">
                            <div class="member-info">
                                <div class="member-avatar">
                                    {{ club.leader.username[0].upper() }}
                                </div>
                                <div class="member-details">
                                    <div class="member-name">
                                        {{ apply_member_cosmetics(club.id,
                                        club.leader.id,
                                        club.leader.username)|safe }}
                                    </div>
                                    <div class="member-email">
                                        {{ club.leader.email }}
                                    </div>
                                </div>
                            </div>
                            <div class="member-meta">
                                <div class="member-role-info">
                                    <span class="role-badge role-badge-leader">
                                        <i class="fas fa-crown"></i> Leader
                                    </span>
                                    <div class="member-joined">
                                        Joined {{
                                        club.created_at.strftime('%Y-%m-%d') }}
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Co-Leader Cards -->
                        {% for membership in club.members %} {% if
                        membership.role == 'co-leader' %}
                        <div class="member-card">
                            <div class="member-info">
                                <div class="member-avatar">
                                    {{ membership.user.username[0].upper() }}
                                </div>
                                <div class="member-details">
                                    <div class="member-name">
                                        {{ apply_member_cosmetics(club.id,
                                        membership.user.id,
                                        membership.user.username)|safe }}
                                    </div>
                                    <div class="member-email">
                                        {{ membership.user.email }}
                                    </div>
                                </div>
                            </div>
                            <div class="member-meta">
                                <div class="member-role-info">
                                    <span
                                        class="role-badge role-badge-co-leader"
                                    >
                                        <i class="fas fa-star"></i> Co-Leader
                                    </span>
                                    <div class="member-joined">
                                        Joined {{
                                        membership.joined_at.strftime('%Y-%m-%d')
                                        }}
                                    </div>
                                </div>
                                {% if club.leader_id == current_user.id %}
                                <div class="member-actions">
                                    <button
                                        class="btn-icon btn-icon-warning"
                                        data-user-id="{{ membership.user.id }}"
                                        data-username="{{ membership.user.username }}"
                                        onclick="removeCoLeader(this.dataset.userId, this.dataset.username)"
                                        title="Remove Co-Leader"
                                    >
                                        <i class="fas fa-minus-circle"></i>
                                    </button>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                        {% endif %} {% endfor %}

                        <!-- Member Cards -->
                        {% for membership in club.members %} {% if
                        membership.user.id != club.leader_id and membership.role
                        != 'co-leader' %}
                        <div class="member-card">
                            <div class="member-info">
                                <div class="member-avatar">
                                    {{ membership.user.username[0].upper() }}
                                </div>
                                <div class="member-details">
                                    <div class="member-name">
                                        {{ apply_member_cosmetics(club.id,
                                        membership.user.id,
                                        membership.user.username)|safe }}
                                    </div>
                                    <div class="member-email">
                                        {{ membership.user.email }}
                                    </div>
                                </div>
                            </div>
                            <div class="member-meta">
                                <div class="member-role-info">
                                    {% if membership.role == 'co-leader' %}
                                    <span
                                        class="role-badge role-badge-co-leader"
                                    >
                                        <i class="fas fa-star"></i> Co-Leader
                                    </span>
                                    {% else %}
                                    <span class="role-badge role-badge-member">
                                        <i class="fas fa-user"></i> Member
                                    </span>
                                    {% endif %}
                                    <div class="member-joined">
                                        Joined {{
                                        membership.joined_at.strftime('%Y-%m-%d')
                                        }}
                                    </div>
                                </div>
                                {% if club.leader_id == current_user.id %}
                                <div class="member-actions">
                                    {% if membership.role != 'co-leader' %}
                                    <button
                                        class="btn-icon btn-icon-success"
                                        data-user-id="{{ membership.user.id }}"
                                        data-username="{{ membership.user.username }}"
                                        onclick="promoteToCoLeader(this.dataset.userId, this.dataset.username)"
                                        title="Make Co-Leader"
                                    >
                                        <i class="fas fa-crown"></i>
                                    </button>
                                    {% endif %}
                                    <button
                                        class="btn-icon btn-icon-danger"
                                        data-user-id="{{ membership.user.id }}"
                                        data-username="{{ membership.user.username }}"
                                        onclick="confirmRemoveMember(this.dataset.userId, this.dataset.username)"
                                        title="Remove Member"
                                    >
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                        {% endif %} {% endfor %}
                    </div>
                </section>

                <section id="chat" class="club-section fade-in">
                    <div class="content-header">
                        <div>
                            <h2><i class="fas fa-comments"></i> Chat</h2>
                            <p>
                                Chat with your club members
                                <span class="text-muted"
                                    >(Slack integration coming soon!)</span
                                >
                            </p>
                        </div>
                    </div>
                    <div class="chat-container">
                        <div class="chat-messages" id="chatMessages">
                            <!-- Messages will be loaded here -->
                        </div>
                        <div class="chat-input-area">
                            <div class="input-group">
                                <div class="input-wrapper">
                                    <input
                                        type="text"
                                        id="chatMessageInput"
                                        class="form-control"
                                        placeholder="Type your message or paste/upload an image..."
                                        maxlength="1000"
                                        disabled
                                    />
                                    <div class="input-actions">
                                        <button
                                            class="input-btn-icon"
                                            type="button"
                                            id="uploadImageButton"
                                            title="Upload image"
                                            disabled
                                        >
                                            <i class="fas fa-image"></i>
                                        </button>
                                        <input
                                            type="file"
                                            id="imageFileInput"
                                            accept="image/jpeg,image/jpg,image/png,image/gif,image/webp"
                                            style="display: none"
                                        />
                                    </div>
                                </div>
                                <button
                                    class="btn btn-primary"
                                    type="button"
                                    id="sendChatMessage"
                                    disabled
                                >
                                    <i class="fas fa-paper-plane"></i> Send
                                </button>
                            </div>
                            <div
                                class="image-preview"
                                id="imagePreview"
                                style="display: none"
                            >
                                <div class="image-preview-container">
                                    <img
                                        id="previewImage"
                                        src=""
                                        alt="Image preview"
                                    />
                                    <button
                                        class="remove-image-btn"
                                        id="removeImagePreview"
                                        title="Remove image"
                                    >
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="chat-status" id="chatStatus">
                                Loading chat...
                            </div>
                        </div>
                    </div>
                </section>

                <section id="resources" class="club-section fade-in">
                    <div class="content-header">
                        <div>
                            <h2><i class="fas fa-link"></i> Resources</h2>
                            <p>Useful links and learning materials</p>
                        </div>
                        {% if effective_can_manage %}
                        <button
                            class="btn btn-primary"
                            onclick="openAddResourceModal()"
                        >
                            <i class="fas fa-plus"></i> Add Resource
                        </button>
                        {% endif %}
                    </div>

                    <div id="resourcesList">
                        <div class="empty-state">
                            <i class="fas fa-book"></i>
                            <h3>No resources yet</h3>
                            <p>
                                Add helpful links and learning materials for
                                your club!
                            </p>
                        </div>
                    </div>
                </section>

                <section id="advertising" class="club-section fade-in">
                    <div class="content-header">
                        <div>
                            <h2><i class="fas fa-bullhorn"></i> Advertising</h2>
                            <p>Create custom posters for your club</p>
                        </div>
                        <button
                            class="btn btn-primary"
                            onclick="openPosterCreator()"
                        >
                            <i class="fas fa-plus"></i> Create Poster
                        </button>
                    </div>

                    <div class="poster-templates">
                        <div class="template-grid compact">
                            <div
                                class="template-card compact"
                                data-template="recruitment"
                                onclick="openPosterCreatorWithTemplate('recruitment')"
                            >
                                <i class="fas fa-user-plus"></i>
                                <span>Join Our Club</span>
                                <button
                                    onclick="event.stopPropagation(); openPosterCreatorWithTemplate('recruitment')"
                                >
                                    <i class="fas fa-edit"></i>
                                </button>
                            </div>
                            <div
                                class="template-card compact"
                                data-template="welcome"
                                onclick="openPosterCreatorWithTemplate('welcome')"
                            >
                                <i class="fas fa-hands-helping"></i>
                                <span>Welcome New Members</span>
                                <button
                                    onclick="event.stopPropagation(); openPosterCreatorWithTemplate('welcome')"
                                >
                                    <i class="fas fa-edit"></i>
                                </button>
                            </div>
                            <div
                                class="template-card compact"
                                data-template="meeting"
                                onclick="openPosterCreatorWithTemplate('meeting')"
                            >
                                <i class="fas fa-users"></i>
                                <span>Club Meeting</span>
                                <button
                                    onclick="event.stopPropagation(); openPosterCreatorWithTemplate('meeting')"
                                >
                                    <i class="fas fa-edit"></i>
                                </button>
                            </div>
                            <div
                                class="template-card compact"
                                data-template="event"
                                onclick="openPosterCreatorWithTemplate('event')"
                            >
                                <i class="fas fa-calendar-alt"></i>
                                <span>Club Events</span>
                                <button
                                    onclick="event.stopPropagation(); openPosterCreatorWithTemplate('event')"
                                >
                                    <i class="fas fa-edit"></i>
                                </button>
                            </div>
                            <div
                                class="template-card compact"
                                data-template="projects"
                                onclick="openPosterCreatorWithTemplate('projects')"
                            >
                                <i class="fas fa-code"></i>
                                <span>Project Showcase</span>
                                <button
                                    onclick="event.stopPropagation(); openPosterCreatorWithTemplate('projects')"
                                >
                                    <i class="fas fa-edit"></i>
                                </button>
                            </div>
                            {% if economy_enabled %}
                            <div
                                class="template-card compact"
                                data-template="shop"
                                onclick="openPosterCreatorWithTemplate('shop')"
                            >
                                <i class="fas fa-shopping-cart"></i>
                                <span>Club Shop</span>
                                <button
                                    onclick="event.stopPropagation(); openPosterCreatorWithTemplate('shop')"
                                >
                                    <i class="fas fa-edit"></i>
                                </button>
                            </div>
                            <div
                                class="template-card compact"
                                data-template="tokens"
                                onclick="openPosterCreatorWithTemplate('tokens')"
                            >
                                <i class="fas fa-coins"></i>
                                <span>Earn Tokens</span>
                                <button
                                    onclick="event.stopPropagation(); openPosterCreatorWithTemplate('tokens')"
                                >
                                    <i class="fas fa-edit"></i>
                                </button>
                            </div>
                            {% endif %}
                            <div
                                class="template-card compact"
                                data-template="custom"
                                onclick="openPosterCreatorWithTemplate('custom')"
                            >
                                <i class="fas fa-paint-brush"></i>
                                <span>Custom Design</span>
                                <button
                                    onclick="event.stopPropagation(); openPosterCreatorWithTemplate('custom')"
                                >
                                    <i class="fas fa-edit"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Branding Resources Section -->
                    <div class="branding-section">
                        <div class="content-header">
                            <div>
                                <h3>
                                    <i class="fas fa-paint-brush"></i> Branding
                                    Resources
                                </h3>
                                <p>
                                    Official Hack Club branding materials and
                                    brand colors
                                </p>
                            </div>
                            <div class="branding-header-actions">
                                <a
                                    href="https://hackclub.com/branding"
                                    target="_blank"
                                    class="btn btn-sm btn-outline"
                                >
                                    <i class="fas fa-external-link-alt"></i>
                                    Full Brand Guide
                                </a>
                                <button
                                    class="btn btn-sm btn-primary"
                                    onclick="downloadAllBrandingAssets()"
                                >
                                    <i class="fas fa-download"></i> Download All
                                    Assets
                                </button>
                            </div>
                        </div>

                        <div class="branding-grid">
                            <!-- Hack Club Logos -->
                            <div class="branding-item">
                                <div class="branding-preview">
                                    <img
                                        src="{{ url_for('static', filename='assets/flag-standalone.png') }}"
                                        alt="Hack Club Logos"
                                        class="logo-preview"
                                    />
                                </div>
                                <div class="branding-info">
                                    <h4>Hack Club Logos</h4>
                                    <p>
                                        Official Hack Club logos and flag
                                        designs
                                    </p>
                                    <button
                                        class="btn btn-sm"
                                        onclick="window.open('https://hackclub.com/branding', '_blank')"
                                    >
                                        <i class="fas fa-external-link-alt"></i>
                                        View All Logos
                                    </button>
                                </div>
                            </div>

                            <!-- Brand Colors -->
                            <div class="branding-item">
                                <div class="branding-preview">
                                    <div class="color-palette">
                                        <div
                                            class="color-swatch"
                                            style="background: #ec3750"
                                            data-color="#ec3750"
                                            title="Red"
                                        ></div>
                                        <div
                                            class="color-swatch"
                                            style="background: #ff8c37"
                                            data-color="#ff8c37"
                                            title="Orange"
                                        ></div>
                                        <div
                                            class="color-swatch"
                                            style="background: #f1c40f"
                                            data-color="#f1c40f"
                                            title="Yellow"
                                        ></div>
                                        <div
                                            class="color-swatch"
                                            style="background: #33d6a6"
                                            data-color="#33d6a6"
                                            title="Green"
                                        ></div>
                                        <div
                                            class="color-swatch"
                                            style="background: #5bc0de"
                                            data-color="#5bc0de"
                                            title="Cyan"
                                        ></div>
                                        <div
                                            class="color-swatch"
                                            style="background: #338eda"
                                            data-color="#338eda"
                                            title="Blue"
                                        ></div>
                                        <div
                                            class="color-swatch"
                                            style="background: #a633d6"
                                            data-color="#a633d6"
                                            title="Purple"
                                        ></div>
                                        <div
                                            class="color-swatch"
                                            style="background: #8492a6"
                                            data-color="#8492a6"
                                            title="Muted"
                                        ></div>
                                    </div>
                                </div>
                                <div class="branding-info">
                                    <h4>Brand Colors</h4>
                                    <p>Official Hack Club color palette</p>
                                    <button
                                        class="btn btn-sm"
                                        onclick="showColorPalette()"
                                    >
                                        <i class="fas fa-palette"></i> View
                                        Colors
                                    </button>
                                </div>
                            </div>

                            <!-- Digital Sticker Library -->
                            <div class="branding-item">
                                <div class="branding-preview sticker-preview">
                                    <div class="sticker-sample">
                                        <img
                                            src="{{ url_for('static', filename='assets/stickers/CleanShot2025-01-28at12.55.412x.png') }}"
                                            alt="Sticker"
                                        />
                                        <img
                                            src="{{ url_for('static', filename='assets/stickers/CleanShot2025-01-28at12.56.342x.png') }}"
                                            alt="Sticker"
                                        />
                                        <img
                                            src="{{ url_for('static', filename='assets/stickers/CleanShot2025-01-28at12.57.062x.png') }}"
                                            alt="Sticker"
                                        />
                                        <span class="more-indicator"
                                            >+40 more</span
                                        >
                                    </div>
                                </div>
                                <div class="branding-info">
                                    <h4>Stickers</h4>
                                    <p>49+ official Hack Club stickers</p>
                                    <div class="sticker-buttons">
                                        <button
                                            class="btn btn-sm"
                                            onclick="openStickerLibrary()"
                                        >
                                            <i class="fas fa-images"></i> Browse
                                            & Download
                                        </button>
                                        <button
                                            class="btn btn-sm btn-outline"
                                            onclick="window.open('https://forms.hackclub.com/stickers', '_blank')"
                                        >
                                            <i class="fas fa-shopping-cart"></i>
                                            Order Stickers
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Physical Posters -->
                            <div class="branding-item">
                                <div class="branding-preview">
                                    <div class="poster-sample">
                                        <i
                                            class="fas fa-print"
                                            style="
                                                font-size: 2em;
                                                color: #338eda;
                                            "
                                        ></i>
                                        <div class="poster-formats">
                                            <span class="format-badge">A3</span>
                                            <span class="format-badge">A4</span>
                                            <span class="format-badge"
                                                >Custom</span
                                            >
                                        </div>
                                    </div>
                                </div>
                                <div class="branding-info">
                                    <h4>Posters</h4>
                                    <p>
                                        Browse digital posters and order prints
                                    </p>
                                    <div class="poster-buttons">
                                        <button
                                            class="btn btn-sm"
                                            onclick="openPosterLibrary()"
                                        >
                                            <i class="fas fa-images"></i> Browse
                                            & Download
                                        </button>
                                        <div class="order-buttons">
                                            <button
                                                class="btn btn-sm btn-outline"
                                                onclick="orderPosters('domestic')"
                                            >
                                                <i class="fas fa-truck"></i> USA
                                                & Canada
                                            </button>
                                            <button
                                                class="btn btn-sm btn-outline"
                                                onclick="orderPosters('international')"
                                            >
                                                <i class="fas fa-globe"></i>
                                                International
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Color Palette Modal -->
                <div id="colorPaletteModal" class="modal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3><i class="fas fa-palette"></i> Brand Colors</h3>
                            <button
                                class="modal-close"
                                onclick="closeColorPalette()"
                            >
                                &times;
                            </button>
                        </div>
                        <div class="modal-body">
                            <p>
                                Official Hack Club brand colors. Click to copy
                                hex codes.
                            </p>
                            <div class="color-palette-detailed">
                                <div
                                    class="color-item"
                                    onclick="copyColor('#ec3750')"
                                >
                                    <div
                                        class="color-preview"
                                        style="background: #ec3750"
                                    ></div>
                                    <div class="color-info">
                                        <strong>Red</strong>
                                        <code>#ec3750</code>
                                    </div>
                                </div>
                                <div
                                    class="color-item"
                                    onclick="copyColor('#ff8c37')"
                                >
                                    <div
                                        class="color-preview"
                                        style="background: #ff8c37"
                                    ></div>
                                    <div class="color-info">
                                        <strong>Orange</strong>
                                        <code>#ff8c37</code>
                                    </div>
                                </div>
                                <div
                                    class="color-item"
                                    onclick="copyColor('#f1c40f')"
                                >
                                    <div
                                        class="color-preview"
                                        style="background: #f1c40f"
                                    ></div>
                                    <div class="color-info">
                                        <strong>Yellow</strong>
                                        <code>#f1c40f</code>
                                    </div>
                                </div>
                                <div
                                    class="color-item"
                                    onclick="copyColor('#33d6a6')"
                                >
                                    <div
                                        class="color-preview"
                                        style="background: #33d6a6"
                                    ></div>
                                    <div class="color-info">
                                        <strong>Green</strong>
                                        <code>#33d6a6</code>
                                    </div>
                                </div>
                                <div
                                    class="color-item"
                                    onclick="copyColor('#5bc0de')"
                                >
                                    <div
                                        class="color-preview"
                                        style="background: #5bc0de"
                                    ></div>
                                    <div class="color-info">
                                        <strong>Cyan</strong>
                                        <code>#5bc0de</code>
                                    </div>
                                </div>
                                <div
                                    class="color-item"
                                    onclick="copyColor('#338eda')"
                                >
                                    <div
                                        class="color-preview"
                                        style="background: #338eda"
                                    ></div>
                                    <div class="color-info">
                                        <strong>Blue</strong>
                                        <code>#338eda</code>
                                    </div>
                                </div>
                                <div
                                    class="color-item"
                                    onclick="copyColor('#a633d6')"
                                >
                                    <div
                                        class="color-preview"
                                        style="background: #a633d6"
                                    ></div>
                                    <div class="color-info">
                                        <strong>Purple</strong>
                                        <code>#a633d6</code>
                                    </div>
                                </div>
                                <div
                                    class="color-item"
                                    onclick="copyColor('#8492a6')"
                                >
                                    <div
                                        class="color-preview"
                                        style="background: #8492a6"
                                    ></div>
                                    <div class="color-info">
                                        <strong>Muted</strong>
                                        <code>#8492a6</code>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button
                                class="btn btn-secondary"
                                onclick="closeColorPalette()"
                            >
                                <i class="fas fa-times"></i> Close
                            </button>
                        </div>
                    </div>
                </div>

                {% if economy_enabled %}
                <section id="transactions" class="club-section fade-in">
                    <div class="content-header">
                        <div>
                            <h2>
                                <i class="fas fa-exchange-alt"></i> Transactions
                            </h2>
                            <p>
                                Track your club's token transactions and balance
                                history
                            </p>
                        </div>
                        <div class="balance-info">
                            <div
                                class="current-balance {% if not has_gallery_post %}locked-feature{% endif %}"
                            >
                                <span class="balance-label"
                                    >Current Balance:</span
                                >
                                <span class="balance-amount">
                                    {% if has_gallery_post %} {{
                                    (club.balance|float * 100)|int }} tokens {%
                                    else %}
                                    <i class="fas fa-lock"></i> Create a gallery
                                    post to unlock {% endif %}
                                </span>
                            </div>
                        </div>
                    </div>

                    <div class="transactions-filters">
                        <div class="filter-group">
                            <label for="transactionTypeFilter"
                                >Filter by type:</label
                            >
                            <select
                                id="transactionTypeFilter"
                                class="form-control"
                            >
                                <option value="">All Types</option>
                                <option value="credit">Credits (+)</option>
                                <option value="debit">Debits (-)</option>
                                <option value="grant">Grants</option>
                                <option value="purchase">Purchases</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="transactionDateFilter"
                                >Date range:</label
                            >
                            <select
                                id="transactionDateFilter"
                                class="form-control"
                            >
                                <option value="">All Time</option>
                                <option value="today">Today</option>
                                <option value="week">This Week</option>
                                <option value="month">This Month</option>
                                <option value="quarter">This Quarter</option>
                            </select>
                        </div>
                    </div>

                    <div id="transactionsList">
                        <div class="loading-state">
                            <i class="fas fa-spinner fa-spin"></i>
                            <p>Loading transactions...</p>
                        </div>
                    </div>

                    <div
                        id="transactionsPagination"
                        class="pagination-container"
                        style="display: none"
                    >
                        <button
                            id="prevPage"
                            class="btn btn-secondary"
                            disabled
                        >
                            Previous
                        </button>
                        <span id="pageInfo">Page 1 of 1</span>
                        <button
                            id="nextPage"
                            class="btn btn-secondary"
                            disabled
                        >
                            Next
                        </button>
                    </div>
                </section>
                {% endif %} {% if economy_enabled %}
                <section id="piggy-bank" class="club-section fade-in">
                    <div class="content-header">
                        <div>
                            <h2>
                                <i class="fas fa-piggy-bank"></i> Piggy Bank
                            </h2>
                            <p>
                                Your club's token savings from approved
                                projects. These tokens accumulate as a fund for
                                future withdrawals and special activities.
                            </p>
                        </div>
                    </div>

                    <div
                        class="current-balance piggy-bank-balance {% if not has_gallery_post %}locked-feature{% endif %}"
                    >
                        <span class="balance-label">Piggy Bank Balance:</span>
                        <span class="balance-amount">
                            {% if has_gallery_post %} {{ club.piggy_bank_tokens
                            or 0 }} tokens {% else %}
                            <i class="fas fa-lock"></i> Create a gallery post to
                            unlock {% endif %}
                        </span>
                    </div>

                    <div class="piggy-bank-info">
                        <div class="info-card">
                            <div class="info-icon">
                                <i class="fas fa-plus-circle"></i>
                            </div>
                            <div class="info-content">
                                <h3>How It Works</h3>
                                <p>
                                    Your club earns 100 tokens in the piggy bank
                                    for every approved project submission. These
                                    tokens are separate from your spending
                                    balance and accumulate over time.
                                </p>
                            </div>
                        </div>

                        <div class="info-card">
                            <div class="info-icon">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <div class="info-content">
                                <h3>Track Your Progress</h3>
                                <p>
                                    Watch your piggy bank grow as your club
                                    members submit successful projects. Each
                                    approval adds to your long-term savings
                                    fund.
                                </p>
                            </div>
                        </div>

                        <div class="info-card">
                            <div class="info-icon">
                                <i class="fas fa-trophy"></i>
                            </div>
                            <div class="info-content">
                                <h3>Quest Rewards</h3>
                                <p>
                                    Quest rewards are drawn from your piggy
                                    bank! Complete weekly quests to transfer 100
                                    tokens from here to your spending balance.
                                    Make sure you have enough saved up!
                                </p>
                            </div>
                        </div>
                    </div>

                    <div class="piggy-bank-transactions">
                        <div class="transactions-header">
                            <h3>
                                <i class="fas fa-history"></i> Piggy Bank
                                History
                            </h3>
                            <p>
                                Track all deposits and withdrawals from your
                                piggy bank
                            </p>
                        </div>

                        <div class="piggy-bank-filters">
                            <div class="filter-group">
                                <label for="piggyBankTypeFilter"
                                    >Filter by type:</label
                                >
                                <select
                                    id="piggyBankTypeFilter"
                                    class="form-control"
                                >
                                    <option value="">All Types</option>
                                    <option value="piggy_bank_credit">
                                        Deposits (+)
                                    </option>
                                    <option value="piggy_bank_debit">
                                        Withdrawals (-)
                                    </option>
                                </select>
                            </div>
                        </div>

                        <div class="table-responsive">
                            <table
                                class="table"
                                id="piggyBankTransactionsTable"
                            >
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Type</th>
                                        <th>Amount</th>
                                        <th>Description</th>
                                        <th>Project</th>
                                    </tr>
                                </thead>
                                <tbody id="piggyBankTransactionsList">
                                    <tr>
                                        <td colspan="5" class="text-center">
                                            <div class="loading-spinner">
                                                <i
                                                    class="fas fa-spinner fa-spin"
                                                ></i>
                                                Loading piggy bank history...
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <div class="pagination-controls">
                            <button
                                id="piggyBankPrevPage"
                                class="btn btn-secondary"
                                disabled
                            >
                                Previous
                            </button>
                            <span id="piggyBankPageInfo">Page 1 of 1</span>
                            <button
                                id="piggyBankNextPage"
                                class="btn btn-secondary"
                                disabled
                            >
                                Next
                            </button>
                        </div>
                    </div>
                </section>
                {% endif %} {% if economy_enabled %}
                <section id="quests" class="club-section fade-in">
                    <div class="content-header">
                        <div>
                            <h2><i class="fas fa-trophy"></i> Weekly Quests</h2>
                            <p>
                                Complete weekly challenges to transfer tokens
                                from your piggy bank to your spending balance
                            </p>
                            <div class="quest-explanation">
                                <div class="explanation-card">
                                    <i class="fas fa-info-circle"></i>
                                    <div class="explanation-content">
                                        <strong>How Quest Rewards Work:</strong>
                                        <p>
                                            Quest rewards are transferred from
                                            your club's piggy bank to your
                                            regular spending balance. If your
                                            piggy bank doesn't have enough
                                            tokens, you won't receive the
                                            reward. Build your piggy bank by
                                            submitting approved projects!
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="quests-container">
                        <div class="quest-card" data-quest-type="gallery_post">
                            <div class="quest-header">
                                <div class="quest-icon">
                                    <i class="fas fa-camera"></i>
                                </div>
                                <div class="quest-info">
                                    <h3>Gallery Post Quest</h3>
                                    <p>
                                        Make a post to the gallery to showcase
                                        your club's work
                                    </p>
                                </div>
                                <div class="quest-reward">
                                    <div class="reward-amount">100 tokens</div>
                                    <div class="reward-source">
                                        from piggy bank
                                    </div>
                                </div>
                            </div>
                            <div class="quest-progress">
                                <div class="progress-bar">
                                    <div
                                        class="progress-fill"
                                        id="galleryProgress"
                                        style="width: 0%"
                                    ></div>
                                </div>
                                <div class="progress-text">
                                    <span id="galleryProgressText"
                                        >0/1 posts</span
                                    >
                                    <span
                                        id="galleryStatus"
                                        class="quest-status pending"
                                        >Pending</span
                                    >
                                </div>
                            </div>
                        </div>

                        <div
                            class="quest-card"
                            data-quest-type="member_projects"
                        >
                            <div class="quest-header">
                                <div class="quest-icon">
                                    <i class="fas fa-users"></i>
                                </div>
                                <div class="quest-info">
                                    <h3>Member Projects Quest</h3>
                                    <p>
                                        Get 5 different members to submit
                                        projects
                                    </p>
                                </div>
                                <div class="quest-reward">
                                    <div class="reward-amount">100 tokens</div>
                                    <div class="reward-source">
                                        from piggy bank
                                    </div>
                                </div>
                            </div>
                            <div class="quest-progress">
                                <div class="progress-bar">
                                    <div
                                        class="progress-fill"
                                        id="membersProgress"
                                        style="width: 0%"
                                    ></div>
                                </div>
                                <div class="progress-text">
                                    <span id="membersProgressText"
                                        >0/5 members</span
                                    >
                                    <span
                                        id="membersStatus"
                                        class="quest-status pending"
                                        >Pending</span
                                    >
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="quest-info-box">
                        <div class="info-icon">
                            <i class="fas fa-info-circle"></i>
                        </div>
                        <div class="info-content">
                            <h4>How Weekly Quests Work</h4>
                            <ul>
                                <li>
                                    Quests reset every Monday at 12:00 AM UTC
                                </li>
                                <li>Complete quests to earn 100 tokens each</li>
                                <li>
                                    Progress is tracked automatically based on
                                    your club's activity
                                </li>
                                <li>
                                    Rewards are distributed immediately upon
                                    completion
                                </li>
                            </ul>
                        </div>
                    </div>
                </section>
                {% endif %} {% if effective_can_manage %}
                <section id="slack" class="club-section fade-in">
                    <div class="content-header">
                        <div>
                            <h2><i class="fab fa-slack"></i> Slack Channel</h2>
                            <p>
                                Connect your club to a Slack channel and invite
                                members. Invitees will only have access to this
                                specific channel unless they complete additional
                                verification with Hack Club.
                            </p>
                        </div>
                    </div>

                    <div class="slack-setup-container">
                        <div class="slack-info-card">
                            <div class="slack-info-header">
                                <i class="fab fa-slack slack-logo"></i>
                                <h3>Set Up Your Club's Slack Channel</h3>
                            </div>
                            <div class="slack-info-content">
                                <p>
                                    Connect your club to a Slack channel to
                                    improve communication and collaboration
                                    among members.
                                </p>

                                <div class="slack-requirements">
                                    <h4>
                                        <i
                                            class="fas fa-exclamation-triangle"
                                        ></i>
                                        Important Requirements:
                                    </h4>
                                    <ul>
                                        <li>
                                            <strong
                                                >Channel must be public</strong
                                            >
                                            - Private channels won't work with
                                            our invitation system
                                        </li>
                                        <li>
                                            <strong>Get the Channel ID</strong>
                                            - Right-click your channel name →
                                            View channel details → Copy Channel
                                            ID
                                        </li>
                                        <li>
                                            <strong>Optional:</strong> Set a
                                            friendly channel name for display
                                            purposes
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <div class="slack-settings-card">
                            <div class="card-header">
                                <h3>Channel Configuration</h3>
                            </div>
                            <div class="card-body">
                                <form id="slackSettingsForm">
                                    <div class="form-group">
                                        <label class="form-label"
                                            >Channel ID *</label
                                        >
                                        <input
                                            type="text"
                                            class="form-control"
                                            id="slackChannelId"
                                            placeholder="C08KBFQ4D54"
                                            pattern="C[A-Z0-9]+"
                                            required
                                        />
                                        <small class="form-help">
                                            <i class="fas fa-info-circle"></i>
                                            Right-click your channel → View
                                            channel details → Copy Channel ID
                                        </small>
                                    </div>

                                    <div class="form-group">
                                        <label class="form-label"
                                            >Channel Name (Optional)</label
                                        >
                                        <input
                                            type="text"
                                            class="form-control"
                                            id="slackChannelName"
                                            placeholder="#my-hack-club"
                                        />
                                        <small class="form-help"
                                            >Friendly name for display
                                            purposes</small
                                        >
                                    </div>

                                    <div class="form-group">
                                        <label class="form-check">
                                            <input
                                                type="checkbox"
                                                id="slackIsPublic"
                                                checked
                                                disabled
                                            />
                                            <span class="form-check-label"
                                                >Channel is public
                                                (required)</span
                                            >
                                        </label>
                                    </div>

                                    <button
                                        type="submit"
                                        class="btn btn-primary"
                                    >
                                        <i class="fas fa-save"></i> Save Channel
                                        Settings
                                    </button>
                                </form>
                            </div>
                        </div>

                        <div
                            class="slack-invite-card"
                            id="slackInviteCard"
                            style="display: none"
                        >
                            <div class="card-header">
                                <h3>Invite Members</h3>
                            </div>
                            <div class="card-body">
                                <div class="invite-options">
                                    <div class="invite-option">
                                        <h4>
                                            <i class="fas fa-users"></i> Invite
                                            All Members
                                        </h4>
                                        <p>
                                            Automatically invite all current
                                            club members to your Slack channel.
                                        </p>
                                        <button
                                            class="btn btn-slack"
                                            onclick="bulkInviteToSlack()"
                                        >
                                            <i class="fab fa-slack"></i> Invite
                                            All Members
                                        </button>
                                    </div>

                                    <div class="invite-divider">
                                        <span>OR</span>
                                    </div>

                                    <div class="invite-option">
                                        <h4>
                                            <i class="fas fa-user-plus"></i>
                                            Invite Individual
                                        </h4>
                                        <div class="individual-invite-form">
                                            <div style="margin-bottom: 1rem">
                                                <label class="form-label"
                                                    >Select Club Member</label
                                                >
                                                <div
                                                    style="
                                                        display: flex;
                                                        gap: 10px;
                                                        align-items: end;
                                                    "
                                                >
                                                    <div style="flex: 1">
                                                        <select
                                                            class="form-control"
                                                            id="individualInviteSelect"
                                                        >
                                                            <option value="">
                                                                Choose a
                                                                member...
                                                            </option>
                                                            <option
                                                                value="{{ club.leader.email }}"
                                                            >
                                                                {{
                                                                club.leader.username
                                                                }} (Leader)
                                                            </option>
                                                            {% if club.co_leader
                                                            %}
                                                            <option
                                                                value="{{ club.co_leader.email }}"
                                                            >
                                                                {{
                                                                club.co_leader.username
                                                                }} (Co-Leader)
                                                            </option>
                                                            {% endif %} {% for
                                                            membership in
                                                            club.members %}
                                                            <option
                                                                value="{{ membership.user.email }}"
                                                            >
                                                                {{
                                                                membership.user.username
                                                                }} (Member)
                                                            </option>
                                                            {% endfor %}
                                                        </select>
                                                    </div>
                                                    <button
                                                        class="btn btn-secondary"
                                                        onclick="inviteIndividualToSlack()"
                                                    >
                                                        <i
                                                            class="fas fa-paper-plane"
                                                        ></i>
                                                        Send Invite
                                                    </button>
                                                </div>
                                            </div>

                                            <div class="invite-divider">
                                                <span>OR</span>
                                            </div>

                                            <div>
                                                <label class="form-label"
                                                    >Invite by Email</label
                                                >
                                                <div
                                                    style="
                                                        display: flex;
                                                        gap: 10px;
                                                        align-items: end;
                                                    "
                                                >
                                                    <div style="flex: 1">
                                                        <input
                                                            type="email"
                                                            class="form-control"
                                                            id="inviteByEmailInput"
                                                            placeholder="Enter email address..."
                                                        />
                                                    </div>
                                                    <button
                                                        class="btn btn-secondary"
                                                        onclick="inviteByEmailToSlack()"
                                                    >
                                                        <i
                                                            class="fas fa-paper-plane"
                                                        ></i>
                                                        Send Invite
                                                    </button>
                                                </div>
                                                <small class="form-help">
                                                    <i
                                                        class="fas fa-info-circle"
                                                    ></i>
                                                    Invite anyone by email
                                                    address. They will only have
                                                    access to this channel.
                                                </small>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div
                                    class="current-channel-info"
                                    id="currentChannelInfo"
                                    style="display: none"
                                >
                                    <div class="channel-info-box">
                                        <i class="fab fa-slack"></i>
                                        <div>
                                            <strong>Current Channel:</strong>
                                            <span id="displayChannelName"
                                                >#channel-name</span
                                            >
                                            <br />
                                            <small
                                                >Channel ID:
                                                <code id="displayChannelId"
                                                    >C08KBFQ4D54</code
                                                ></small
                                            >
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
                {% endif %} {% if current_user.id == club.leader_id %}
                <section id="settings" class="club-section fade-in">
                    <div class="content-header">
                        <div>
                            <h2><i class="fas fa-cogs"></i> Settings</h2>
                            <p>Club settings and configuration</p>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3>Club Information</h3>
                        </div>
                        <div class="card-body">
                            <!-- Club ID Display -->
                            <div class="form-group">
                                <label class="form-label">Club ID</label>
                                <div
                                    class="form-control-static"
                                    style="
                                        background: #f8f9fa;
                                        border: 1px solid #dee2e6;
                                        padding: 0.375rem 0.75rem;
                                        border-radius: 0.375rem;
                                        display: flex;
                                        align-items: center;
                                        justify-content: space-between;
                                    "
                                >
                                    <span
                                        style="
                                            font-family:
                                                &quot;Courier New&quot;,
                                                monospace;
                                            font-weight: 600;
                                            color: #495057;
                                        "
                                        >{{ club.id }}</span
                                    >
                                    <button
                                        type="button"
                                        class="btn btn-sm btn-outline-secondary"
                                        onclick="copyClubId()"
                                        title="Copy Club ID"
                                    >
                                        <i class="fas fa-copy"></i>
                                    </button>
                                </div>
                                <small class="form-text text-muted">
                                    <i class="fas fa-info-circle"></i>
                                    Use this ID for API requests and
                                    administrative operations
                                </small>
                            </div>

                            <form id="clubSettingsForm">
                                <div class="form-group">
                                    <label class="form-label">Club Name</label>
                                    <input
                                        type="text"
                                        class="form-control"
                                        id="clubName"
                                        value="{{ club.name }}"
                                    />
                                </div>
                                <div class="form-group">
                                    <label class="form-label"
                                        >Description</label
                                    >
                                    <textarea
                                        class="form-control"
                                        id="clubDescription"
                                        rows="3"
                                    >
{{ club.description or '' }}</textarea
                                    >
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Location</label>
                                    <input
                                        type="text"
                                        class="form-control"
                                        id="clubLocation"
                                        value="{{ club.location or '' }}"
                                    />
                                </div>
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-save"></i> Save Changes
                                </button>
                            </form>
                        </div>
                    </div>

                    {% if current_user.id == club.leader_id %}
                    <!-- Email Update Section (Leaders Only) -->
                    <div class="card" style="margin-top: 2rem">
                        <div class="card-header">
                            <h3 style="color: #17a2b8">
                                <i class="fas fa-envelope"></i> Leader Email
                            </h3>
                            <p
                                style="
                                    margin: 0.5rem 0 0 0;
                                    color: #6b7280;
                                    font-size: 0.9rem;
                                "
                            >
                                Update the club leader email in Hack Club
                                records
                            </p>
                        </div>
                        <div class="card-body">
                            <div
                                style="
                                    background: #d1ecf1;
                                    border: 1px solid #bee5eb;
                                    border-radius: 8px;
                                    padding: 1rem;
                                    margin-bottom: 1.5rem;
                                "
                            >
                                <p
                                    style="
                                        margin: 0;
                                        color: #0c5460;
                                        font-size: 0.9rem;
                                    "
                                >
                                    <i
                                        class="fas fa-info-circle"
                                        style="
                                            color: #17a2b8;
                                            margin-right: 0.5rem;
                                        "
                                    ></i>
                                    <strong>Current dashboard email:</strong> {{
                                    current_user.email }}<br />
                                    This will update the leader email field in
                                    our official records to match your dashboard
                                    email if they're different. This is normally
                                    just for debug purposes.
                                </p>
                            </div>

                            <button
                                type="button"
                                class="btn btn-info"
                                onclick="updateClubEmail()"
                                id="updateEmailBtn"
                            >
                                <i class="fas fa-sync-alt"></i> Update Club
                                Email
                            </button>
                        </div>
                    </div>
                    {% endif %}

                    <div class="card" style="margin-top: 2rem">
                        <div class="card-header">
                            <h3 style="color: #dc3545">
                                <i class="fas fa-crown"></i> Leadership Transfer
                            </h3>
                            <p
                                style="
                                    margin: 0.5rem 0 0 0;
                                    color: #6b7280;
                                    font-size: 0.9rem;
                                "
                            >
                                Transfer club leadership to another member
                            </p>
                        </div>
                        <div class="card-body">
                            <div
                                style="
                                    background: #fff3cd;
                                    border: 1px solid #ffeaa7;
                                    border-radius: 8px;
                                    padding: 1rem;
                                    margin-bottom: 1.5rem;
                                "
                            >
                                <p
                                    style="
                                        margin: 0;
                                        color: #856404;
                                        font-size: 0.9rem;
                                    "
                                >
                                    <i
                                        class="fas fa-exclamation-triangle"
                                        style="
                                            color: #f39c12;
                                            margin-right: 0.5rem;
                                        "
                                    ></i>
                                    <strong>Warning:</strong> This action will
                                    permanently transfer club leadership. You
                                    will become a regular member.
                                </p>
                            </div>
                            <div class="form-group">
                                <label class="form-label"
                                    >Select New Leader</label
                                >
                                <select
                                    class="form-control"
                                    id="newLeaderSelect"
                                >
                                    <option value="">
                                        Choose a member to become the new leader
                                    </option>
                                    {% for membership in club.members %}
                                    <option value="{{ membership.user.id }}">
                                        {{ membership.user.username }} ({{
                                        membership.user.email }})
                                    </option>
                                    {% endfor %}
                                </select>
                            </div>
                            <button
                                class="btn"
                                style="background-color: #dc3545; color: white"
                                onclick="initiateLeadershipTransfer()"
                            >
                                <i class="fas fa-exchange-alt"></i> Transfer
                                Leadership
                            </button>
                        </div>
                    </div>

                    <!-- Background Customization Section -->
                    <div class="card" style="margin-top: 2rem">
                        <div class="card-header">
                            <h3 style="color: #8b5cf6">
                                <i class="fas fa-image"></i> Background
                                Customization
                            </h3>
                            <p
                                style="
                                    margin: 0.5rem 0 0 0;
                                    color: #6b7280;
                                    font-size: 0.9rem;
                                "
                            >
                                Customize your club's background image
                            </p>
                        </div>
                        <div class="card-body">
                            <!-- Current Background Display -->
                            <div class="form-group">
                                <label class="form-label"
                                    >Current Background</label
                                >
                                <div
                                    id="currentBackgroundPreview"
                                    style="
                                    width: 100%;
                                    height: 200px;
                                    border: 2px dashed #dee2e6;
                                    border-radius: 8px;
                                    display: flex;
                                    align-items: center;
                                    justify-content: center;
                                    background-size: cover;
                                    background-position: center;
                                    background-repeat: no-repeat;
                                    {% if club.background_image_url %}
                                    background-image: url('{{ club.background_image_url }}');
                                    {% else %}
                                    background-color: #f8f9fa;
                                    {% endif %}
                                "
                                >
                                    {% if not club.background_image_url %}
                                    <div
                                        style="
                                            text-align: center;
                                            color: #6c757d;
                                        "
                                    >
                                        <i
                                            class="fas fa-image"
                                            style="
                                                font-size: 3rem;
                                                margin-bottom: 1rem;
                                            "
                                        ></i>
                                        <p>No background image set</p>
                                    </div>
                                    {% endif %}
                                </div>
                            </div>

                            <!-- Upload New Background -->
                            <div class="form-group">
                                <label class="form-label"
                                    >Upload Background Image</label
                                >
                                <div
                                    style="
                                        background: #e3f2fd;
                                        border: 1px solid #bbdefb;
                                        border-radius: 8px;
                                        padding: 1rem;
                                        margin-bottom: 1rem;
                                    "
                                >
                                    <p
                                        style="
                                            margin: 0;
                                            color: #1565c0;
                                            font-size: 0.9rem;
                                        "
                                    >
                                        <i
                                            class="fas fa-info-circle"
                                            style="margin-right: 0.5rem"
                                        ></i>
                                        <strong>Tips:</strong> Best results with
                                        landscape images (16:9 ratio). Max file
                                        size: 10MB.
                                    </p>
                                </div>
                                <input
                                    type="file"
                                    class="form-control"
                                    id="backgroundUpload"
                                    accept="image/png,image/jpg,image/jpeg,image/gif,image/webp"
                                    style="margin-bottom: 1rem"
                                />
                                <button
                                    type="button"
                                    class="btn btn-primary"
                                    onclick="uploadBackgroundImage()"
                                    id="uploadBackgroundBtn"
                                >
                                    <i class="fas fa-upload"></i> Upload
                                    Background
                                </button>
                            </div>

                            <!-- Blur functionality removed -->

                            <!-- Remove Background -->
                            {% if club.background_image_url %}
                            <div
                                class="form-group"
                                style="
                                    border-top: 1px solid #dee2e6;
                                    padding-top: 1rem;
                                    margin-top: 1.5rem;
                                "
                            >
                                <button
                                    type="button"
                                    class="btn btn-outline-danger"
                                    onclick="removeBackground()"
                                    id="removeBackgroundBtn"
                                >
                                    <i class="fas fa-trash-alt"></i> Remove
                                    Background
                                </button>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </section>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<div
    id="toastContainer"
    class="toast-container"
    style="position: fixed; bottom: 20px; right: 20px; z-index: 9999"
></div>

<!-- Chat Delete Confirmation Modal -->
<div id="deleteChatMessageModal" class="modal" style="display: none">
    <div class="modal-content">
        <div class="modal-header error">
            <h3>
                <i class="fas fa-exclamation-triangle"></i>
                Delete Message
            </h3>
            <button
                onclick="closeModal('deleteChatMessageModal')"
                class="modal-close"
            >
                &times;
            </button>
        </div>
        <div class="modal-body">
            <p>
                Are you sure you want to delete this message? This action cannot
                be undone.
            </p>
            <div class="message-preview" id="deleteMessagePreview">
                <!-- Message preview will be shown here -->
            </div>
        </div>
        <div class="modal-footer">
            <button
                onclick="closeModal('deleteChatMessageModal')"
                class="btn-modal btn-secondary"
            >
                Cancel
            </button>
            <button id="confirmDeleteMessage" class="btn-modal btn-danger">
                <i class="fas fa-trash"></i> Delete Message
            </button>
        </div>
    </div>
</div>

<!-- Remove Background Confirmation Modal -->
<div id="removeBackgroundModal" class="modal" style="display: none">
    <div class="modal-content">
        <div class="modal-header error">
            <h3>
                <i class="fas fa-exclamation-triangle"></i>
                Remove Background
            </h3>
            <button
                onclick="closeModal('removeBackgroundModal')"
                class="modal-close"
            >
                &times;
            </button>
        </div>
        <div class="modal-body">
            <p>
                Are you sure you want to remove the custom background image?
                This will restore the default dinosaur background and cannot be
                undone.
            </p>
        </div>
        <div class="modal-footer">
            <button
                onclick="closeModal('removeBackgroundModal')"
                class="btn-modal btn-secondary"
            >
                Cancel
            </button>
            <button id="confirmRemoveBackground" class="btn-modal btn-danger">
                <i class="fas fa-trash-alt"></i> Remove Background
            </button>
        </div>
    </div>
</div>

<!-- Chat Edit Message Modal -->
<div id="editChatMessageModal" class="modal" style="display: none">
    <div class="modal-content">
        <div class="modal-header primary">
            <h3>
                <i class="fas fa-edit"></i>
                Edit Message
            </h3>
            <button
                onclick="closeModal('editChatMessageModal')"
                class="modal-close"
            >
                &times;
            </button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label for="editMessageContent">Message</label>
                <textarea
                    class="form-control"
                    id="editMessageContent"
                    rows="4"
                    maxlength="1000"
                    placeholder="Edit your message..."
                ></textarea>
                <div class="character-count">
                    <span id="editCharacterCount">0</span>/1000 characters
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button
                onclick="closeModal('editChatMessageModal')"
                class="btn-modal btn-secondary"
            >
                Cancel
            </button>
            <button id="confirmEditMessage" class="btn-modal btn-primary">
                <i class="fas fa-save"></i> Save Changes
            </button>
        </div>
    </div>
</div>

<div id="confirmModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>
                <i class="fas fa-exclamation-triangle text-warning"></i> Confirm
                Action
            </h3>
            <button
                class="close"
                onclick="document.getElementById('confirmModal').style.display='none'"
            >
                &times;
            </button>
        </div>
        <div class="modal-body">
            <p id="confirmMessage">Are you sure you want to proceed?</p>
        </div>
        <div class="modal-footer">
            <button
                class="btn btn-secondary"
                onclick="document.getElementById('confirmModal').style.display='none'"
            >
                Cancel
            </button>
            <button id="confirmButton" class="btn btn-primary">Confirm</button>
        </div>
    </div>
</div>

<div id="qrModal" class="modal qr-modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3><i class="fas fa-qrcode"></i> Join {{ club.name }}</h3>
            <button
                class="close"
                onclick="document.getElementById('qrModal').style.display='none'"
            >
                &times;
            </button>
        </div>
        <div class="modal-body" style="text-align: center">
            <div class="qr-code-container">
                <div
                    id="qrcode"
                    style="
                        display: flex;
                        justify-content: center;
                        margin-bottom: 1rem;
                    "
                ></div>
                <p style="margin-bottom: 1rem; color: #6b7280">
                    Scan this QR code to join the club
                </p>
                <div
                    class="join-url-box"
                    style="display: flex; gap: 0.5rem; margin-top: 1rem"
                >
                    <input
                        type="text"
                        id="joinUrl"
                        readonly
                        style="
                            flex: 1;
                            padding: 0.5rem;
                            border: 1px solid #e2e8f0;
                            border-radius: 6px;
                            font-size: 0.875rem;
                        "
                    />
                    <button
                        class="btn btn-secondary btn-sm"
                        onclick="copyJoinUrl()"
                    >
                        <i class="fas fa-copy"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Join Code Display Modal -->
<div id="joinCodeModal" class="modal join-code-modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3><i class="fas fa-key"></i> Club Join Code</h3>
            <button
                class="close"
                onclick="document.getElementById('joinCodeModal').style.display='none'"
            >
                &times;
            </button>
        </div>
        <div class="modal-body" style="text-align: center">
            <div class="join-code-display-large">
                <p style="margin-bottom: 1rem; color: #6b7280; font-size: 1.1rem;">
                    Share this code with people who want to join {{ club.name }}
                </p>
                <div class="join-code-big">
                    {{ club.join_code }}
                </div>
                <p style="margin-top: 1rem; color: #6b7280; font-size: 0.95rem;">
                    Have them visit <strong>hack.club/join</strong> and enter this code
                </p>
                <button
                    class="btn btn-secondary"
                    onclick="copyJoinCode()"
                    style="margin-top: 1.5rem;"
                >
                    <i class="fas fa-copy"></i> Copy Join Code
                </button>
            </div>
        </div>
    </div>
</div>

<div id="createAssignmentModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Create Assignment</h3>
            <button
                class="close"
                onclick="document.getElementById('createAssignmentModal').style.display='none'"
            >
                &times;
            </button>
        </div>
        <div class="modal-body">
            <form id="createAssignmentForm">
                <div class="form-group">
                    <label class="form-label">Title</label>
                    <input
                        type="text"
                        class="form-control"
                        id="assignmentTitle"
                        required
                    />
                </div>
                <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea
                        class="form-control"
                        id="assignmentDescription"
                        rows="4"
                        required
                    ></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Due Date (Optional)</label>
                    <input
                        type="date"
                        class="form-control"
                        id="assignmentDueDate"
                    />
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="assignmentForAll" checked />
                        For all members
                    </label>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button
                class="btn btn-secondary"
                onclick="document.getElementById('createAssignmentModal').style.display='none'"
            >
                Cancel
            </button>
            <button class="btn btn-primary" onclick="createAssignment()">
                <i class="fas fa-plus"></i> Create Assignment
            </button>
        </div>
    </div>
</div>

<div id="createMeetingModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Schedule Meeting</h3>
            <button
                class="close"
                onclick="document.getElementById('createMeetingModal').style.display='none'"
            >
                &times;
            </button>
        </div>
        <div class="modal-body">
            <form id="createMeetingForm">
                <div class="form-group">
                    <label class="form-label">Title</label>
                    <input
                        type="text"
                        class="form-control"
                        id="meetingTitle"
                        required
                    />
                </div>
                <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea
                        class="form-control"
                        id="meetingDescription"
                        rows="3"
                    ></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Date</label>
                    <input
                        type="date"
                        class="form-control"
                        id="meetingDate"
                        required
                    />
                </div>
                <div class="row">
                    <div class="col-6">
                        <div class="form-group">
                            <label class="form-label">Start Time</label>
                            <input
                                type="time"
                                class="form-control"
                                id="meetingStartTime"
                                required
                            />
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="form-group">
                            <label class="form-label">End Time</label>
                            <input
                                type="time"
                                class="form-control"
                                id="meetingEndTime"
                            />
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Location</label>
                    <input
                        type="text"
                        class="form-control"
                        id="meetingLocation"
                    />
                </div>
                <div class="form-group">
                    <label class="form-label">Meeting Link (Optional)</label>
                    <input
                        type="url"
                        class="form-control"
                        id="meetingLink"
                        placeholder="https://..."
                    />
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button
                class="btn btn-secondary"
                onclick="document.getElementById('createMeetingModal').style.display='none'"
            >
                Cancel
            </button>
            <button class="btn btn-primary" onclick="createMeeting()">
                <i class="fas fa-calendar-plus"></i> Schedule Meeting
            </button>
        </div>
    </div>
</div>

<div id="addResourceModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Add Resource</h3>
            <button
                class="close"
                onclick="document.getElementById('addResourceModal').style.display='none'"
            >
                &times;
            </button>
        </div>
        <div class="modal-body">
            <form id="addResourceForm">
                <div class="form-group">
                    <label class="form-label">Title</label>
                    <input
                        type="text"
                        class="form-control"
                        id="resourceTitle"
                        required
                    />
                </div>
                <div class="form-group">
                    <label class="form-label">URL</label>
                    <input
                        type="url"
                        class="form-control"
                        id="resourceUrl"
                        required
                    />
                </div>
                <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea
                        class="form-control"
                        id="resourceDescription"
                        rows="3"
                    ></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Icon</label>
                    <select class="form-control" id="resourceIcon">
                        <option value="book">Book</option>
                        <option value="link">Link</option>
                        <option value="video">Video</option>
                        <option value="code">Code</option>
                        <option value="file-alt">Article</option>
                        <option value="graduation-cap">Tutorial</option>
                        <option value="external-link-alt">External</option>
                    </select>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button
                class="btn btn-secondary"
                onclick="document.getElementById('addResourceModal').style.display='none'"
            >
                Cancel
            </button>
            <button class="btn btn-primary" onclick="addResource()">
                <i class="fas fa-plus"></i> Add Resource
            </button>
        </div>
    </div>
</div>

<div id="transferLeadershipModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 style="color: #dc3545">
                <i class="fas fa-crown"></i> Transfer Leadership
            </h3>
            <button
                class="close"
                onclick="document.getElementById('transferLeadershipModal').style.display='none'"
            >
                &times;
            </button>
        </div>
        <div class="modal-body">
            <div
                style="
                    background: #f8d7da;
                    border: 1px solid #f5c6cb;
                    border-radius: 8px;
                    padding: 1rem;
                    margin-bottom: 1.5rem;
                "
            >
                <p style="margin: 0; color: #721c24; font-weight: 600">
                    <i
                        class="fas fa-exclamation-triangle"
                        style="color: #dc3545; margin-right: 0.5rem"
                    ></i>
                    Are you sure you want to transfer leadership?
                </p>
            </div>
            <p style="margin-bottom: 1rem; color: #495057">
                You are about to transfer leadership of
                <strong>{{ club.name }}</strong> to:
            </p>
            <div
                style="
                    background: #e9ecef;
                    border-radius: 8px;
                    padding: 1rem;
                    margin-bottom: 1.5rem;
                "
            >
                <div style="display: flex; align-items: center; gap: 0.75rem">
                    <div
                        style="
                            width: 40px;
                            height: 40px;
                            background: #6c757d;
                            border-radius: 50%;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            color: white;
                            font-weight: bold;
                        "
                        id="newLeaderAvatar"
                    >
                        ?
                    </div>
                    <div>
                        <div
                            style="font-weight: 600; color: #212529"
                            id="newLeaderName"
                        >
                            Select a member
                        </div>
                        <div
                            style="font-size: 0.875rem; color: #6c757d"
                            id="newLeaderEmail"
                        ></div>
                    </div>
                </div>
            </div>
            <div
                style="
                    background: #fff3cd;
                    border: 1px solid #ffeaa7;
                    border-radius: 8px;
                    padding: 1rem;
                    margin-bottom: 1.5rem;
                "
            >
                <p style="margin: 0; color: #856404; font-size: 0.9rem">
                    <i
                        class="fas fa-info-circle"
                        style="color: #f39c12; margin-right: 0.5rem"
                    ></i>
                    After transfer, you will become a regular member and will no
                    longer have leader privileges.
                </p>
            </div>
            <div class="form-group">
                <label class="form-label">Type "TRANSFER" to confirm:</label>
                <input
                    type="text"
                    class="form-control"
                    id="transferConfirmationInput"
                    placeholder="Type TRANSFER to confirm"
                />
            </div>
        </div>
        <div class="modal-footer">
            <button
                class="btn btn-secondary"
                onclick="document.getElementById('transferLeadershipModal').style.display='none'"
            >
                Cancel
            </button>
            <button
                id="confirmTransferButton"
                class="btn"
                style="background-color: #dc3545; color: white"
                onclick="confirmLeadershipTransfer()"
                disabled
            >
                <i class="fas fa-exchange-alt"></i> Transfer Leadership
            </button>
        </div>
    </div>
</div>

<div id="slackBulkInviteModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3><i class="fab fa-slack"></i> Invite All Members</h3>
            <button class="close" onclick="closeSlackBulkInviteModal()">
                &times;
            </button>
        </div>
        <div class="modal-body">
            <div
                style="
                    background: #fff3cd;
                    border: 1px solid #ffeaa7;
                    border-radius: 8px;
                    padding: 1rem;
                    margin-bottom: 1.5rem;
                "
            >
                <p style="margin: 0; color: #856404; font-size: 0.9rem">
                    <i
                        class="fas fa-info-circle"
                        style="color: #f39c12; margin-right: 0.5rem"
                    ></i>
                    This will invite all current club members to the Slack
                    channel.
                </p>
            </div>
            <p>You are about to invite all members to:</p>
            <div
                style="
                    background: #f3f4f6;
                    border-radius: 8px;
                    padding: 1rem;
                    margin-bottom: 1.5rem;
                "
            >
                <div style="display: flex; align-items: center; gap: 1rem">
                    <i
                        class="fab fa-slack"
                        style="font-size: 1.5rem; color: #4a154b"
                    ></i>
                    <div>
                        <strong id="bulkInviteChannelName"
                            >#channel-name</strong
                        >
                        <br />
                        <small
                            >Channel ID:
                            <code id="bulkInviteChannelId"
                                >C08KBFQ4D54</code
                            ></small
                        >
                    </div>
                </div>
            </div>
            <p style="color: #6b7280; font-size: 0.9rem">
                Members will only have access to this specific channel unless
                they complete additional verification with Hack Club.
            </p>
        </div>
        <div class="modal-footer">
            <button
                class="btn btn-secondary"
                onclick="closeSlackBulkInviteModal()"
            >
                Cancel
            </button>
            <button class="btn btn-primary" onclick="confirmBulkInvite()">
                <i class="fab fa-slack"></i> Send Invitations
            </button>
        </div>
    </div>
</div>

<div id="slackInviteResultModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3><i class="fab fa-slack"></i> Invitation Result</h3>
            <button class="close" onclick="closeSlackInviteResultModal()">
                &times;
            </button>
        </div>
        <div class="modal-body">
            <div id="slackInviteResultContent"></div>
        </div>
        <div class="modal-footer">
            <button
                class="btn btn-primary"
                onclick="closeSlackInviteResultModal()"
            >
                OK
            </button>
        </div>
    </div>
</div>

<!-- Cart Modal will be dynamically created -->

<!-- Sticker Library Modal -->
<div id="stickerLibraryModal" class="modal">
    <div class="modal-content large">
        <div class="modal-header">
            <h3><i class="fas fa-images"></i> Stickers</h3>
            <button class="modal-close" onclick="closeStickerLibrary()">
                &times;
            </button>
        </div>
        <div class="modal-body">
            <p>
                Download official Hack Club stickers for your projects and
                posters.
            </p>
            <div class="sticker-library-grid" id="stickerLibraryGrid">
                <!-- Stickers will be loaded here -->
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeStickerLibrary()">
                <i class="fas fa-times"></i> Close
            </button>
            <button class="btn btn-primary" onclick="downloadAllStickers()">
                <i class="fas fa-download"></i> Download All as ZIP
            </button>
        </div>
    </div>
</div>

<!-- Poster Library Modal -->
<div id="posterLibraryModal" class="modal">
    <div class="modal-content large">
        <div class="modal-header">
            <h3><i class="fas fa-images"></i> Posters</h3>
            <button class="modal-close" onclick="closePosterLibrary()">
                &times;
            </button>
        </div>
        <div class="modal-body">
            <p>Download official Hack Club posters for your club.</p>
            <div class="poster-library-grid" id="posterLibraryGrid">
                <!-- Posters will be loaded here -->
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closePosterLibrary()">
                <i class="fas fa-times"></i> Close
            </button>
            <button class="btn btn-primary" onclick="downloadAllPosters()">
                <i class="fas fa-download"></i> Download All as ZIP
            </button>
        </div>
    </div>
</div>

<div id="purchaseRequestModal" class="modal">
    <div class="modal-content" style="max-width: 600px">
        <div class="modal-header">
            <h3>Request Purchase</h3>
            <button
                class="close"
                onclick="document.getElementById('purchaseRequestModal').style.display='none'"
            >
                &times;
            </button>
        </div>
        <div class="modal-body" style="max-height: 80vh; overflow-y: auto">
            <form id="purchaseRequestForm">
                <div class="row">
                    <div class="col-6">
                        <div class="form-group">
                            <label class="form-label"
                                >Leader First Name *</label
                            >
                            <input
                                type="text"
                                class="form-control"
                                id="leaderFirstName"
                                value="{{ current_user.first_name or '' }}"
                                required
                            />
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="form-group">
                            <label class="form-label">Leader Last Name *</label>
                            <input
                                type="text"
                                class="form-control"
                                id="leaderLastName"
                                value="{{ current_user.last_name or '' }}"
                                required
                            />
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Leader Email *</label>
                    <input
                        type="email"
                        class="form-control"
                        id="leaderEmail"
                        value="{{ current_user.email }}"
                        required
                    />
                </div>

                <div class="form-group">
                    <label class="form-label">Club Name</label>
                    <input
                        type="text"
                        class="form-control"
                        id="clubName"
                        value="{{ club.name }}"
                        readonly
                        style="background-color: #f8f9fa"
                    />
                </div>

                <div class="form-group">
                    <label class="form-label">Purchase Type *</label>
                    <select class="form-control" id="purchaseType" required>
                        <option value="">Select purchase type</option>
                        <option value="Pizza/Food">Pizza/Food</option>
                        <option value="Software">Software</option>
                        <option value="Hardware">Hardware</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Purchase Description *</label>
                    <textarea
                        class="form-control"
                        id="purchaseDescription"
                        rows="3"
                        placeholder="Describe what you want to purchase and how it will benefit the club"
                        required
                    ></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">Purchase Reason *</label>
                    <textarea
                        class="form-control"
                        id="purchaseReason"
                        rows="2"
                        placeholder="Why does your club need this?"
                        required
                    ></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">Amount *</label>
                    <div style="position: relative">
                        <input
                            type="number"
                            class="form-control"
                            id="purchaseAmount"
                            step="0.01"
                            min="0.01"
                            placeholder="0.00"
                            required
                            style="padding-left: 1.5rem"
                        />
                        <span
                            style="
                                position: absolute;
                                left: 0.5rem;
                                top: 50%;
                                transform: translateY(-50%);
                                color: #6b7280;
                            "
                            >$</span
                        >
                    </div>
                    <small style="color: #64748b; font-size: 0.875rem"
                        >Available tokens:
                        <span id="purchaseBalanceDisplay"
                            >{{ (club.balance|float * 100)|int }}</span
                        >
                        tokens ></small
                    >
                </div>

                <div class="form-group">
                    <label class="form-label">Fulfillment Method *</label>
                    <select
                        class="form-control"
                        id="fulfillmentMethod"
                        required
                    >
                        <option value="">Select fulfillment method</option>
                        <option value="Card Grant">Card Grant</option>
                        <option value="HCB Transfer">HCB Transfer</option>
                        <option value="Reimbursement">Reimbursement</option>
                    </select>
                    <small style="color: #64748b; font-size: 0.875rem"
                        >How you want to receive/use the funds</small
                    >
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button
                class="btn btn-secondary"
                onclick="document.getElementById('purchaseRequestModal').style.display='none'"
            >
                Cancel
            </button>
            <button class="btn btn-primary" onclick="submitPurchaseRequest()">
                <i class="fas fa-paper-plane"></i> Submit Request
            </button>
        </div>
    </div>
</div>

<div id="cardGrantModal" class="modal">
    <div class="modal-content" style="max-width: 800px">
        <div class="modal-header">
            <h3>Submit Project for Card Grant</h3>
            <button
                class="close"
                onclick="document.getElementById('cardGrantModal').style.display='none'"
            >
                &times;
            </button>
        </div>
        <div class="modal-body" style="max-height: 80vh; overflow-y: auto">
            <form id="cardGrantForm">
                <div class="form-group">
                    <label class="form-label">Select Club Member *</label>
                    <select
                        class="form-control"
                        id="grantMemberSelect"
                        onchange="loadMemberHackatimeProjects()"
                        required
                    >
                        <option value="{{ current_user.id }}">
                            {{ current_user.username }} (You)
                        </option>
                        {% if club.leader_id == current_user.id %} {% for
                        membership in club.members %}
                        <option value="{{ membership.user.id }}">
                            {{ membership.user.username }}
                        </option>
                        {% endfor %} {% endif %}
                    </select>
                    {% if club.leader_id == current_user.id %}
                    <small style="color: #64748b; font-size: 0.875rem"
                        >Club leaders can submit grants on behalf of
                        members</small
                    >
                    {% endif %}
                </div>

                <div class="form-group">
                    <label class="form-label">Select Your Project *</label>
                    <select
                        class="form-control"
                        id="grantProjectSelect"
                        required
                    >
                        <option value="">Select your project</option>
                    </select>
                    <small style="color: #64748b; font-size: 0.875rem"
                        >Only projects tracked on Hackatime are shown
                        here</small
                    >
                </div>

                <div class="form-group">
                    <label class="form-label">Project Description *</label>
                    <textarea
                        class="form-control"
                        id="grantDescription"
                        rows="3"
                        placeholder="Briefly describe what you built and what you learned"
                        required
                    ></textarea>
                </div>

                <div class="row">
                    <div class="col-6">
                        <div class="form-group">
                            <label class="form-label">GitHub URL *</label>
                            <input
                                type="url"
                                class="form-control"
                                id="grantGithubUrl"
                                placeholder="https://github.com/username/repository"
                                required
                            />
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="form-group">
                            <label class="form-label">Live URL *</label>
                            <input
                                type="url"
                                class="form-control"
                                id="grantLiveUrl"
                                placeholder="https://example.com"
                                required
                            />
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Upload Screenshot *</label>
                    <input
                        type="file"
                        class="form-control"
                        id="grantScreenshot"
                        accept="image/*"
                        required
                    />
                    <small style="color: #64748b; font-size: 0.875rem"
                        >Upload a screenshot of your project. The image will be
                        uploaded to our database and the URL will be used for
                        submission.</small
                    >
                </div>

                <div class="form-group">
                    <div
                        style="
                            background: #fef3c7;
                            border: 1px solid #f59e0b;
                            border-radius: 8px;
                            padding: 1rem;
                            margin-bottom: 1rem;
                        "
                    >
                        <h4
                            style="
                                color: #92400e;
                                margin: 0 0 0.5rem 0;
                                font-size: 1rem;
                                display: flex;
                                align-items: center;
                                gap: 0.5rem;
                            "
                        >
                            <i class="fas fa-exclamation-triangle"></i> Meeting
                            Requirements
                        </h4>
                        <p style="color: #92400e; margin: 0; font-size: 0.9rem">
                            To be eligible for grants, this project must have
                            been worked on during an in-person club meeting, and
                            your club must have at least 3 members.
                        </p>
                    </div>
                    <div class="form-check" style="margin-top: 1rem">
                        <input
                            type="checkbox"
                            class="form-check-input"
                            id="grantInPersonMeeting"
                            required
                        />
                        <label
                            class="form-check-label"
                            for="grantInPersonMeeting"
                        >
                            <strong
                                >I confirm this project was worked on during an
                                in-person club meeting *</strong
                            >
                        </label>
                    </div>
                    <small style="color: #64748b; font-size: 0.875rem"
                        >Virtual meetings are not eligible for grants. Your club
                        currently has {{ club.members|length + 1 }}
                        member(s).</small
                    >
                </div>

                <div class="form-group">
                    <label class="form-label"
                        >What did you learn about while making this project?
                        *</label
                    >
                    <textarea
                        class="form-control"
                        id="grantLearning"
                        rows="3"
                        placeholder="Share what you learned while making your project!"
                        required
                    ></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">What are we doing well? *</label>
                    <textarea
                        class="form-control"
                        id="grantDoingWell"
                        rows="2"
                        placeholder="What do you like about Hack Club Spaces?"
                        required
                    ></textarea>
                </div>

                <div class="row">
                    <div class="col-6">
                        <div class="form-group">
                            <label class="form-label">First Name *</label>
                            <input
                                type="text"
                                class="form-control"
                                id="grantFirstName"
                                placeholder="Your first name"
                                required
                            />
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="form-group">
                            <label class="form-label">Last Name *</label>
                            <input
                                type="text"
                                class="form-control"
                                id="grantLastName"
                                placeholder="Your last name"
                                required
                            />
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-6">
                        <div class="form-group">
                            <label class="form-label">Email *</label>
                            <input
                                type="email"
                                class="form-control"
                                id="grantEmail"
                                placeholder="Your email address"
                                required
                            />
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="form-group">
                            <label class="form-label">Birthday *</label>
                            <input
                                type="date"
                                class="form-control"
                                id="grantBirthday"
                                required
                            />
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Address Line 1 *</label>
                    <input
                        type="text"
                        class="form-control"
                        id="grantAddress1"
                        placeholder="Street address"
                        required
                    />
                </div>

                <div class="form-group">
                    <label class="form-label">Address Line 2</label>
                    <input
                        type="text"
                        class="form-control"
                        id="grantAddress2"
                        placeholder="Apt, Suite, Building (optional)"
                    />
                </div>

                <div class="row">
                    <div class="col-4">
                        <div class="form-group">
                            <label class="form-label">City *</label>
                            <input
                                type="text"
                                class="form-control"
                                id="grantCity"
                                required
                            />
                        </div>
                    </div>
                    <div class="col-4">
                        <div class="form-group">
                            <label class="form-label">State/Province *</label>
                            <input
                                type="text"
                                class="form-control"
                                id="grantState"
                                required
                            />
                        </div>
                    </div>
                    <div class="col-4">
                        <div class="form-group">
                            <label class="form-label">ZIP/Postal Code *</label>
                            <input
                                type="text"
                                class="form-control"
                                id="grantZip"
                                required
                            />
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Country *</label>
                    <input
                        type="text"
                        class="form-control"
                        id="grantCountry"
                        required
                    />
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button
                class="btn btn-secondary"
                onclick="document.getElementById('cardGrantModal').style.display='none'"
            >
                Cancel
            </button>
            <button class="btn btn-primary" onclick="submitCardGrant()">
                <i class="fas fa-paper-plane"></i> Submit Grant
            </button>
        </div>
    </div>
</div>
{% endblock %} {% block extra_scripts %}
<style>
    .dashboard-header {
        text-align: center;
        margin-bottom: 3rem;
        padding: 2rem;
        background: linear-gradient(
            135deg,
            rgba(255, 255, 255, 0.1) 0%,
            rgba(255, 255, 255, 0.05) 100%
        );
        border-radius: 20px;
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        position: relative;
    }

    .art-submission-banner {
        background: linear-gradient(
            135deg,
            #ff6b35 0%,
            #f7931e 50%,
            #ffd700 100%
        );
        border-radius: 20px;
        margin-bottom: 2rem;
        position: relative;
        overflow: hidden;
        box-shadow: 0 20px 40px rgba(255, 107, 53, 0.3);
        animation: bannerGlow 3s ease-in-out infinite;
    }

    @keyframes bannerGlow {
        0%,
        100% {
            box-shadow: 0 20px 40px rgba(255, 107, 53, 0.3);
            transform: translateY(0);
        }
        50% {
            box-shadow: 0 25px 50px rgba(255, 107, 53, 0.4);
            transform: translateY(-2px);
        }
    }

    .banner-content {
        display: flex;
        align-items: center;
        gap: 1.5rem;
        padding: 1.5rem 2rem;
        position: relative;
        z-index: 2;
    }

    .banner-icon {
        width: 60px;
        height: 60px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        color: white;
        backdrop-filter: blur(10px);
        animation: iconSpin 6s linear infinite;
        flex-shrink: 0;
    }

    @keyframes iconSpin {
        0% {
            transform: rotate(0deg);
        }
        100% {
            transform: rotate(360deg);
        }
    }

    .banner-text {
        flex: 1;
        color: white;
    }

    .banner-text h3 {
        margin: 0 0 0.5rem 0;
        font-size: 1.4rem;
        font-weight: 700;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        animation: textFloat 2s ease-in-out infinite;
    }

    @keyframes textFloat {
        0%,
        100% {
            transform: translateY(0);
        }
        50% {
            transform: translateY(-3px);
        }
    }

    .banner-text p {
        margin: 0;
        font-size: 1rem;
        opacity: 0.95;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
    }

    .banner-cta {
        background: rgba(255, 255, 255, 0.95);
        color: #ff6b35;
        padding: 0.75rem 1.5rem;
        border-radius: 25px;
        text-decoration: none;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        animation: ctaPulse 2s ease-in-out infinite;
        flex-shrink: 0;
    }

    @keyframes ctaPulse {
        0%,
        100% {
            transform: scale(1);
        }
        50% {
            transform: scale(1.05);
        }
    }

    .banner-cta:hover {
        background: white;
        transform: translateY(-2px) scale(1.1);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        color: #e55a2b;
    }

    .banner-decorations {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        pointer-events: none;
        z-index: 1;
    }

    .decoration {
        position: absolute;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.1);
        animation: decorationFloat 8s ease-in-out infinite;
    }

    .decoration-1 {
        width: 40px;
        height: 40px;
        top: 20%;
        right: 10%;
        animation-delay: 0s;
    }

    .decoration-2 {
        width: 60px;
        height: 60px;
        bottom: 15%;
        left: 15%;
        animation-delay: 2s;
    }

    .decoration-3 {
        width: 30px;
        height: 30px;
        top: 60%;
        right: 25%;
        animation-delay: 4s;
    }

    @keyframes decorationFloat {
        0%,
        100% {
            transform: translateY(0) rotate(0deg);
            opacity: 0.3;
        }
        50% {
            transform: translateY(-15px) rotate(180deg);
            opacity: 0.6;
        }
    }

    @media (max-width: 768px) {
        .banner-content {
            flex-direction: column;
            text-align: center;
            gap: 1rem;
            padding: 1.5rem;
        }

        .banner-text h3 {
            font-size: 1.2rem;
        }

        .banner-text p {
            font-size: 0.9rem;
        }

        .banner-cta {
            align-self: stretch;
            justify-content: center;
        }
    }
</style>

<!-- Tutorial Overlay -->
<div id="tutorialOverlay" class="tutorial-overlay" style="display: none">
    <div class="tutorial-backdrop"></div>
    <div class="tutorial-bubble" id="tutorialBubble">
        <div class="tutorial-content">
            <div class="tutorial-header">
                <h3 id="tutorialTitle">Welcome to your Club Dashboard!</h3>
                <button class="tutorial-close" onclick="closeTutorial()">
                    &times;
                </button>
            </div>
            <div class="tutorial-body">
                <p id="tutorialText">
                    Let's take a quick tour of your club dashboard and show you
                    all the amazing features available.
                </p>
            </div>
            <div class="tutorial-footer">
                <div class="tutorial-progress">
                    <span id="tutorialStep">1</span> of
                    <span id="tutorialTotal">10</span>
                </div>
                <div class="tutorial-buttons">
                    <button
                        class="tutorial-btn tutorial-btn-secondary"
                        id="prevBtn"
                        onclick="previousStep()"
                        disabled
                    >
                        Previous
                    </button>
                    <button
                        class="tutorial-btn tutorial-btn-primary"
                        id="nextBtn"
                        onclick="nextStep()"
                    >
                        Next
                    </button>
                    <button
                        class="tutorial-btn tutorial-btn-primary"
                        id="finishBtn"
                        onclick="closeTutorial()"
                        style="display: none"
                    >
                        Finish
                    </button>
                </div>
            </div>
        </div>
        <div class="tutorial-arrow" id="tutorialArrow"></div>
    </div>
</div>

<!-- Tutorial Styles -->
<style>
    .tutorial-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 10000;
        pointer-events: none;
    }

    .tutorial-backdrop {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.4);
        pointer-events: all;
    }

    .tutorial-bubble {
        position: absolute;
        background: #ffffff;
        border-radius: 12px;
        box-shadow:
            0 20px 25px -5px rgba(0, 0, 0, 0.1),
            0 10px 10px -5px rgba(0, 0, 0, 0.04);
        max-width: 400px;
        min-width: 300px;
        pointer-events: all;
        transform-origin: center center;
        animation: tutorialAppear 0.3s ease-out;
        border: 2px solid #ec3750;
    }

    @keyframes tutorialAppear {
        0% {
            opacity: 0;
            transform: scale(0.8) translateY(10px);
        }
        100% {
            opacity: 1;
            transform: scale(1) translateY(0);
        }
    }

    .tutorial-content {
        padding: 0;
    }

    .tutorial-header {
        padding: 20px 20px 0 20px;
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
    }

    .tutorial-header h3 {
        margin: 0;
        color: #1a202c;
        font-size: 1.25rem;
        font-weight: 600;
        line-height: 1.4;
        flex: 1;
        padding-right: 10px;
    }

    .tutorial-close {
        background: none;
        border: none;
        font-size: 24px;
        color: #6b7280;
        cursor: pointer;
        padding: 0;
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 6px;
        transition: all 0.2s ease;
        flex-shrink: 0;
    }

    .tutorial-close:hover {
        background: #f3f4f6;
        color: #374151;
    }

    .tutorial-body {
        padding: 15px 20px 20px 20px;
    }

    .tutorial-body p {
        margin: 0;
        color: #4b5563;
        line-height: 1.6;
        font-size: 0.95rem;
    }

    .tutorial-footer {
        padding: 0 20px 20px 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .tutorial-progress {
        font-size: 0.875rem;
        color: #6b7280;
        font-weight: 500;
    }

    .tutorial-progress #tutorialStep {
        color: #ec3750;
        font-weight: 600;
    }

    .tutorial-buttons {
        display: flex;
        gap: 10px;
    }

    .tutorial-btn {
        padding: 8px 16px;
        border-radius: 6px;
        font-size: 0.875rem;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s ease;
        border: none;
        min-width: 80px;
    }

    .tutorial-btn-primary {
        background: #ec3750;
        color: white;
    }

    .tutorial-btn-primary:hover:not(:disabled) {
        background: #dc2626;
        transform: translateY(-1px);
    }

    .tutorial-btn-secondary {
        background: #f3f4f6;
        color: #374151;
        border: 1px solid #d1d5db;
    }

    .tutorial-btn-secondary:hover:not(:disabled) {
        background: #e5e7eb;
    }

    .tutorial-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    .tutorial-arrow {
        position: absolute;
        width: 16px;
        height: 16px;
        background: #ffffff;
        border: 2px solid #ec3750;
        transform: rotate(45deg);
        border-radius: 0 0 4px 0;
    }

    .tutorial-arrow.top {
        top: -10px;
        left: 50%;
        margin-left: -8px;
        border-top: none;
        border-left: none;
    }

    .tutorial-arrow.bottom {
        bottom: -10px;
        left: 50%;
        margin-left: -8px;
        border-bottom: none;
        border-right: none;
    }

    .tutorial-arrow.left {
        left: -10px;
        top: 50%;
        margin-top: -8px;
        border-left: none;
        border-bottom: none;
    }

    .tutorial-arrow.right {
        right: -10px;
        top: 50%;
        margin-top: -8px;
        border-right: none;
        border-top: none;
    }

    .tutorial-highlight {
        position: relative;
        z-index: 9999;
        box-shadow:
            0 0 0 4px rgba(236, 55, 80, 0.3),
            0 0 0 8px rgba(236, 55, 80, 0.1);
        border-radius: 8px;
        transition: all 0.3s ease;
    }

    .tutorial-highlight.club-header {
        position: sticky !important;
        top: 70px !important;
        z-index: 10000 !important;
    }

    .tutorial-highlight.sidebar-nav,
    .tutorial-highlight .nav-link {
        position: relative !important;
        z-index: 9998 !important;
    }

    .dashboard-sidebar.tutorial-highlight {
        position: sticky !important;
        top: 190px !important;
        z-index: 9998 !important;
    }

    .tutorial-pulse {
        animation: tutorialPulse 2s infinite;
    }

    @keyframes tutorialPulse {
        0%,
        100% {
            box-shadow:
                0 0 0 4px rgba(236, 55, 80, 0.3),
                0 0 0 8px rgba(236, 55, 80, 0.1);
        }
        50% {
            box-shadow:
                0 0 0 6px rgba(236, 55, 80, 0.4),
                0 0 0 12px rgba(236, 55, 80, 0.15);
        }
    }

    /* Grouped buttons container */
    .action-buttons-container {
        position: fixed;
        bottom: 20px;
        left: 20px;
        display: flex;
        flex-direction: column;
        z-index: 1000;
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(20px);
        padding: 16px;
        border-radius: 20px;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        border: 1px solid rgba(255, 255, 255, 0.2);
    }

    /* Tutorial button styles */
    .tutorial-start-btn {
        background: #ec3750;
        color: white;
        border: none;
        border-radius: 50px;
        padding: 12px 20px;
        font-size: 0.9rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 8px;
        min-width: 140px;
        justify-content: center;
        box-shadow: 0 4px 12px rgba(236, 55, 80, 0.3);
    }

    .tutorial-start-btn:hover {
        background: #dc2626;
        transform: translateY(-2px);
        box-shadow: 0 6px 16px rgba(236, 55, 80, 0.4);
    }

    .tutorial-start-btn i {
        font-size: 1rem;
    }

    @media (max-width: 768px) {
        .tutorial-bubble {
            max-width: calc(100vw - 40px);
            min-width: auto;
        }

        .action-buttons-container {
            bottom: 15px;
            left: 15px;
            padding: 12px;
        }

        .tutorial-start-btn {
            padding: 10px 16px;
            font-size: 0.85rem;
            min-width: 120px;
        }
    }
</style>

<script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.0/build/qrcode.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
<script>
    // Make club data available globally
    window.clubData = {
        clubId: {{ club.id }},
        joinCode: '{{ club.join_code }}',
        isLeader: {{ 'true' if club.leader_id == current_user.id else 'false' }},
        balance: {{ club.balance|float }},
        name: '{{ club.name }}',
        economyEnabled: {{ 'true' if economy_enabled else 'false' }},
        isAdminAccess: {{ 'true' if is_admin_access else 'false' }}
    };

    // Make current user email available globally
    window.currentUserEmail = '{{ current_user.email }}';

    // Helper function to add admin parameter to API URLs when needed
    window.buildApiUrl = function(url) {
        if (window.clubData && window.clubData.isAdminAccess) {
            const separator = url.includes('?') ? '&' : '?';
            return url + separator + 'admin=true';
        }
        return url;
    };

    // Make user role available globally
    window.userRole = '{% if current_user.id == club.leader_id %}leader{% elif is_co_leader %}co-leader{% elif is_admin_access %}admin{% else %}member{% endif %}';

    // Initialize club data for dash.js
    clubId = {{ club.id }};
    joinCode = '{{ club.join_code }}';

    // Tutorial System
    let currentTutorialStep = 0;
    let isFirstVisit = !localStorage.getItem('clubDashboardTutorialCompleted');

    const allTutorialSteps = [
        {
            title: "Welcome to your Club Dashboard! 🎉",
            text: "This is your command center for managing your Hack Club. Let's explore all the amazing features available to you!",
            target: ".club-header",
            position: "bottom",
            action: null
        },
        {
            title: "Club Information",
            text: "Here you can see your club's basic info including location, creation date, and member count. This gives you a quick overview of your club.",
            target: ".club-details",
            position: "bottom",
            action: null
        },
        {
            title: "Join Code & Token Balance",
            text: "Your unique join code helps new members join your club, and you can see your current token balance here. Click the QR code button to share it easily!",
            target: ".club-actions",
            position: "left",
            action: null,
            requiresEconomy: true
        },
        {
            title: "Join Code",
            text: "Your unique join code helps new members join your club. Click the QR code button to share it easily!",
            target: ".club-actions",
            position: "left",
            action: null,
            requiresEconomy: false
        },
        {
            title: "Navigation Sidebar",
            text: "This sidebar contains all your dashboard sections. Each section provides different tools for managing your club effectively.",
            target: ".dashboard-sidebar",
            position: "right",
            action: null
        },
        {
            title: "Member Management",
            text: "Use these sections to manage your club members, assign tasks, and track member projects. Perfect for keeping everyone engaged!",
            target: "[data-section='members']",
            position: "right",
            action: () => document.querySelector("[data-section='members']").click()
        },
        {
            title: "Weekly Quests System 🏆",
            text: "Complete weekly challenges to earn tokens! Post to the gallery or get members to submit projects. Quests reset every Monday!",
            target: "[data-section='quests']",
            position: "right",
            action: () => document.querySelector("[data-section='quests']").click(),
            requiresEconomy: true
        },
        {
            title: "Quest Progress Tracking",
            text: "Track your progress on weekly quests here. Each completed quest rewards your club with 100 tokens automatically!",
            target: ".quests-container",
            position: "top",
            action: null,
            requiresEconomy: true
        },
        {
            title: "Transaction History",
            text: "View all your club's token transactions here - quest rewards, purchases, and more. Keep track of your club's financial activity!",
            target: "[data-section='transactions']",
            position: "right",
            action: () => document.querySelector("[data-section='transactions']").click(),
            requiresEconomy: true
        },
        {
            title: "Club Shop 🛒",
            text: "Leaders can spend tokens in the club shop! Let's visit the shop to see how to purchase items for your club.",
            target: ".shop-link",
            position: "right",
            action: null,
            isExternal: true,
            externalUrl: function() {
                const clubId = window.clubData ? window.clubData.clubId : clubId;
                return `/club/${clubId}/shop`;
            },
            requiresEconomy: true
        },
        {
            title: "Project Submissions",
            text: "Submit projects here to earn grants and contribute to your weekly quest progress. Great way to showcase your work!",
            target: ".project-link",
            position: "right",
            action: null,
            isExternal: true,
            requiresEconomy: true
        },
        {
            title: "Resources & Links",
            text: "Share helpful resources and links with your club members. Keep all your important materials organized in one place.",
            target: "[data-section='resources']",
            position: "right",
            action: () => document.querySelector("[data-section='resources']").click()
        },
        {
            title: "Schedule Management",
            text: "Plan and organize club meetings and events. Keep everyone informed about upcoming activities and deadlines.",
            target: "[data-section='schedule']",
            position: "right",
            action: () => document.querySelector("[data-section='schedule']").click()
        },
        {
            title: "Explore the Gallery! 📸",
            text: "Don't forget to check out the gallery to see amazing projects from clubs worldwide. You can also post your own work there!",
            target: ".dashboard-content",
            position: "top",
            action: null,
            isExternal: true,
            externalUrl: "/gallery",
            requiresEconomy: true
        },
        {
            title: "You're all set! 🚀",
            text: window.clubData.economyEnabled ?
                "You now know the basics of your club dashboard! Use quests to earn tokens, shop for supplies, and showcase your projects. Happy hacking!" :
                "You now know the basics of your club dashboard! Manage your members, share resources, and organize events. Happy hacking!",
            target: ".dashboard-content",
            position: "top",
            action: () => document.querySelector("[data-section='dashboard']").click()
        }
    ];

    // Filter tutorial steps based on economy status
    const tutorialSteps = allTutorialSteps.filter(step => {
        if (step.requiresEconomy === true && !window.clubData.economyEnabled) {
            return false; // Skip economy-required steps when economy is disabled
        }
        if (step.requiresEconomy === false && window.clubData.economyEnabled) {
            return false; // Skip non-economy steps when economy is enabled (for steps with alternatives)
        }
        return true;
    });

    function startTutorial() {
        currentTutorialStep = 0;
        document.getElementById('tutorialOverlay').style.display = 'block';
        showTutorialStep(currentTutorialStep);
    }

    function showTutorialStep(stepIndex) {
        const step = tutorialSteps[stepIndex];
        const bubble = document.getElementById('tutorialBubble');
        const arrow = document.getElementById('tutorialArrow');

        // Update content
        document.getElementById('tutorialTitle').textContent = step.title;
        document.getElementById('tutorialText').textContent = step.text;
        document.getElementById('tutorialStep').textContent = stepIndex + 1;
        document.getElementById('tutorialTotal').textContent = tutorialSteps.length;

        // Update buttons
        document.getElementById('prevBtn').disabled = stepIndex === 0;

        // Handle external link steps
        if (step.isExternal) {
            if (step.externalUrl === "/gallery") {
                document.getElementById('nextBtn').textContent = 'Visit Gallery';
            } else if (typeof step.externalUrl === 'function') {
                document.getElementById('nextBtn').textContent = 'Visit Shop';
            } else {
                document.getElementById('nextBtn').textContent = 'Got it!';
            }
        } else {
            document.getElementById('nextBtn').textContent = 'Next';
        }

        document.getElementById('nextBtn').style.display = stepIndex === tutorialSteps.length - 1 ? 'none' : 'inline-block';
        document.getElementById('finishBtn').style.display = stepIndex === tutorialSteps.length - 1 ? 'inline-block' : 'none';

        // Clear previous highlights
        document.querySelectorAll('.tutorial-highlight').forEach(el => {
            el.classList.remove('tutorial-highlight', 'tutorial-pulse');
        });

        // Position bubble and highlight target
        setTimeout(() => {
            const targetElement = document.querySelector(step.target);
            if (targetElement) {
                targetElement.classList.add('tutorial-highlight', 'tutorial-pulse');

                // Special handling for sticky header
                if (step.target === '.club-header') {
                    targetElement.classList.add('club-header');
                }

                // Special handling for sidebar elements
                if (step.target === '.dashboard-sidebar' || step.target.includes('[data-section=')) {
                    if (step.target === '.dashboard-sidebar') {
                        targetElement.classList.add('sidebar-nav');
                    }
                }

                positionBubble(bubble, arrow, targetElement, step.position);

                // Execute step action
                if (step.action) {
                    setTimeout(step.action, 500);
                }
            } else {
                // If target element doesn't exist (e.g., economy features are disabled),
                // position the bubble in the center of the screen
                bubble.style.left = '50%';
                bubble.style.top = '50%';
                bubble.style.transform = 'translate(-50%, -50%)';
                arrow.style.display = 'none';
            }
        }, 100);
    }

    function positionBubble(bubble, arrow, target, position) {
        const targetRect = target.getBoundingClientRect();
        const bubbleRect = bubble.getBoundingClientRect();
        const viewportWidth = window.innerWidth;
        const viewportHeight = window.innerHeight;

        // Reset arrow classes
        arrow.className = 'tutorial-arrow';

        let bubbleX, bubbleY, arrowClass;

        switch (position) {
            case 'top':
                bubbleX = targetRect.left + targetRect.width / 2 - bubbleRect.width / 2;
                bubbleY = targetRect.top - bubbleRect.height - 20;
                arrowClass = 'bottom';
                break;
            case 'bottom':
                bubbleX = targetRect.left + targetRect.width / 2 - bubbleRect.width / 2;
                bubbleY = targetRect.bottom + 20;
                arrowClass = 'top';
                break;
            case 'left':
                bubbleX = targetRect.left - bubbleRect.width - 20;
                bubbleY = targetRect.top + targetRect.height / 2 - bubbleRect.height / 2;
                arrowClass = 'right';
                break;
            case 'right':
                bubbleX = targetRect.right + 20;
                bubbleY = targetRect.top + targetRect.height / 2 - bubbleRect.height / 2;
                arrowClass = 'left';
                break;
        }

        // Keep bubble within viewport and below navbar
        const navbarHeight = 70; // Account for top navbar
        bubbleX = Math.max(20, Math.min(viewportWidth - bubbleRect.width - 20, bubbleX));
        bubbleY = Math.max(navbarHeight + 20, Math.min(viewportHeight - bubbleRect.height - 20, bubbleY));

        bubble.style.left = bubbleX + 'px';
        bubble.style.top = bubbleY + 'px';
        arrow.classList.add(arrowClass);
    }

    function nextStep() {
        const currentStep = tutorialSteps[currentTutorialStep];

        // Handle external navigation
        if (currentStep.isExternal && currentStep.externalUrl) {
            // Skip external navigation if it requires economy and economy is disabled
            if (currentStep.requiresEconomy && !window.clubData.economyEnabled) {
                // Skip this step and continue to next
                if (currentTutorialStep < tutorialSteps.length - 1) {
                    currentTutorialStep++;
                    showTutorialStep(currentTutorialStep);
                } else {
                    closeTutorial();
                }
                return;
            }

            // Store tutorial state
            localStorage.setItem('tutorialInProgress', 'true');
            localStorage.setItem('tutorialCurrentStep', currentTutorialStep + 1);
            // Navigate to external page
            const url = typeof currentStep.externalUrl === 'function' ? currentStep.externalUrl() : currentStep.externalUrl;
            window.location.href = url;
            return;
        }

        if (currentTutorialStep < tutorialSteps.length - 1) {
            currentTutorialStep++;
            showTutorialStep(currentTutorialStep);
        }
    }

    function previousStep() {
        if (currentTutorialStep > 0) {
            currentTutorialStep--;
            showTutorialStep(currentTutorialStep);
        }
    }

    function closeTutorial() {
        document.getElementById('tutorialOverlay').style.display = 'none';
        document.querySelectorAll('.tutorial-highlight').forEach(el => {
            el.classList.remove('tutorial-highlight', 'tutorial-pulse');
        });
        localStorage.setItem('clubDashboardTutorialCompleted', 'true');
        // Hide tutorial button after completion
        const startBtn = document.querySelector('.tutorial-start-btn');
        if (startBtn) startBtn.style.display = 'none';
    }

    // Handle keyboard navigation
    document.addEventListener('keydown', function(e) {
        if (document.getElementById('tutorialOverlay').style.display === 'block') {
            if (e.key === 'ArrowRight' || e.key === 'Enter') {
                e.preventDefault();
                if (currentTutorialStep === tutorialSteps.length - 1) {
                    closeTutorial();
                } else {
                    nextStep();
                }
            } else if (e.key === 'ArrowLeft') {
                e.preventDefault();
                previousStep();
            } else if (e.key === 'Escape') {
                e.preventDefault();
                closeTutorial();
            }
        }
    });

    // Check for tutorial restoration on page load
    function checkTutorialRestore() {
        const tutorialInProgress = localStorage.getItem('tutorialInProgress');
        const savedStep = localStorage.getItem('tutorialCurrentStep');

        if (tutorialInProgress === 'true' && savedStep) {
            // Clear stored state
            localStorage.removeItem('tutorialInProgress');
            localStorage.removeItem('tutorialCurrentStep');

            // Resume tutorial from saved step
            currentTutorialStep = parseInt(savedStep);
            document.getElementById('tutorialOverlay').style.display = 'block';
            showTutorialStep(currentTutorialStep);
            return true;
        }
        return false;
    }

    // Auto-start tutorial for first-time visitors
    document.addEventListener('DOMContentLoaded', function() {
        // First check if we're restoring from another page
        if (!checkTutorialRestore()) {
            // If not restoring and it's first visit, start tutorial
            if (isFirstVisit) {
                setTimeout(startTutorial, 1000);
            }
        }
    });

    // Initialize club data for dash.js
    clubId = {{ club.id }};
    joinCode = '{{ club.join_code }}';

    // Initialize custom background on page load
    document.addEventListener('DOMContentLoaded', function() {
        const dashboard = document.querySelector('.club-dashboard');
        if (dashboard && dashboard.dataset.hasBackground === 'true') {
            const backgroundUrl = dashboard.dataset.backgroundUrl;

            // Set the background image directly
            dashboard.style.backgroundImage = `url('${backgroundUrl}')`;
        }
    });

    // Add event listener for background removal confirmation
    document.addEventListener('DOMContentLoaded', function() {
        const confirmBtn = document.getElementById('confirmRemoveBackground');
        if (confirmBtn) {
            confirmBtn.addEventListener('click', confirmRemoveBackground);
        }
    });

    // Background Customization Functions
    function uploadBackgroundImage() {
        const fileInput = document.getElementById('backgroundUpload');
        const uploadBtn = document.getElementById('uploadBackgroundBtn');

        if (!fileInput.files || fileInput.files.length === 0) {
            showToast('error', 'Please select an image file first', 'No File Selected');
            return;
        }

        const file = fileInput.files[0];
        const formData = new FormData();
        formData.append('image', file);

        // Disable button and show loading
        uploadBtn.disabled = true;
        uploadBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Uploading...';

        fetch(`/api/clubs/${clubId}/background`, {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                showToast('success', 'Background image uploaded successfully', 'Upload Complete');

                // Update preview
                const preview = document.getElementById('currentBackgroundPreview');
                preview.style.backgroundImage = `url('${data.background_url}')`;
                preview.innerHTML = ''; // Remove "no background" message

                // Update the main dashboard background immediately
                const dashboard = document.querySelector('.club-dashboard');
                dashboard.style.backgroundImage = `url('${data.background_url}')`;
                dashboard.setAttribute('data-has-background', 'true');
                dashboard.setAttribute('data-background-url', data.background_url);

                // Show remove button if it doesn't exist
                if (!document.getElementById('removeBackgroundBtn')) {
                    location.reload(); // Reload to show remove button
                }

                // Clear file input
                fileInput.value = '';
            } else {
                showToast('error', data.error || 'Failed to upload background image', 'Upload Failed');
            }
        })
        .catch(error => {
            console.error('Error uploading background:', error);
            showToast('error', 'Network error occurred while uploading', 'Upload Failed');
        })
        .finally(() => {
            // Re-enable button
            uploadBtn.disabled = false;
            uploadBtn.innerHTML = '<i class="fas fa-upload"></i> Upload Background';
        });
    }

    // Removed blur functionality

    // Removed blur settings function

    function removeBackground() {
        // Show the confirmation modal instead of browser alert
        showModal('removeBackgroundModal');
    }

    function confirmRemoveBackground() {
        // Close the modal first
        closeModal('removeBackgroundModal');

        const removeBtn = document.getElementById('removeBackgroundBtn');

        // Disable button and show loading
        removeBtn.disabled = true;
        removeBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Removing...';

        fetch(`/api/clubs/${clubId}/background`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                remove_background: true
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                showToast('success', 'Background image removed successfully', 'Background Removed');

                // Update preview to show no background
                const preview = document.getElementById('currentBackgroundPreview');
                preview.style.backgroundImage = 'none';
                preview.style.backgroundColor = '#f8f9fa';
                preview.innerHTML = `
                    <div style="text-align: center; color: #6c757d;">
                        <i class="fas fa-image" style="font-size: 3rem; margin-bottom: 1rem;"></i>
                        <p>No background image set</p>
                    </div>
                `;

                // Remove background and restore default dinos
                const dashboard = document.querySelector('.club-dashboard');

                if (dashboard) {
                    dashboard.style.backgroundImage = '';
                    dashboard.removeAttribute('data-has-background');
                    dashboard.removeAttribute('data-background-url');
                }

                // Reload page to hide remove button
                setTimeout(() => location.reload(), 1000);
            } else {
                showToast('error', data.error || 'Failed to remove background image', 'Remove Failed');
            }
        })
        .catch(error => {
            console.error('Error removing background:', error);
            showToast('error', 'Network error occurred while removing background', 'Remove Failed');
        })
        .finally(() => {
            // Re-enable button
            removeBtn.disabled = false;
            removeBtn.innerHTML = '<i class="fas fa-trash-alt"></i> Remove Background';
        });
    }

    // Join Code Modal Functions
    function showJoinCodeModal() {
        document.getElementById('joinCodeModal').style.display = 'block';
    }

    function copyJoinCode() {
        const joinCode = '{{ club.join_code }}';
        navigator.clipboard.writeText(joinCode).then(function() {
            // Show success message
            const btn = event.target.closest('button');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-check"></i> Copied!';
            btn.style.background = '#10b981';
            setTimeout(() => {
                btn.innerHTML = originalText;
                btn.style.background = '';
            }, 2000);
        }).catch(function(err) {
            // Fallback for older browsers
            const textArea = document.createElement("textarea");
            textArea.value = joinCode;
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            try {
                document.execCommand('copy');
                const btn = event.target.closest('button');
                const originalText = btn.innerHTML;
                btn.innerHTML = '<i class="fas fa-check"></i> Copied!';
                btn.style.background = '#10b981';
                setTimeout(() => {
                    btn.innerHTML = originalText;
                    btn.style.background = '';
                }, 2000);
            } catch (err) {
                console.error('Failed to copy: ', err);
            }
            document.body.removeChild(textArea);
        });
    }
</script>

<script>
    // Close modal with Escape key
    document.addEventListener("keydown", function (e) {
        if (e.key === "Escape") {
            const joinModal = document.getElementById("joinClubModal");
            if (joinModal && joinModal.style.display === "block") {
                closeJoinModal();
            }
        }
    });

    // Leave club functionality
    function confirmLeaveClub() {
        const clubName = '{{ club.name }}';
        const confirmMessage = `Are you sure you want to leave ${clubName}?\n\nThis action cannot be undone. You will need a new join code to rejoin the club.`;

        if (confirm(confirmMessage)) {
            leaveClub();
        }
    }

    function leaveClub() {
        const leaveBtn = document.getElementById('leaveClubBtn');
        if (leaveBtn) {
            leaveBtn.disabled = true;
            leaveBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Leaving...';
        }

        fetch(`/api/clubs/{{ club.id }}/leave`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('You have successfully left {{ club.name }}. You will be redirected to your dashboard.');
                window.location.href = '/dashboard';
            } else {
                alert('Error: ' + (data.error || 'Failed to leave club'));
                if (leaveBtn) {
                    leaveBtn.disabled = false;
                    leaveBtn.innerHTML = '<i class="fas fa-sign-out-alt"></i> Leave {{ club.name }}';
                }
            }
        })
        .catch(error => {
            console.error('Error leaving club:', error);
            alert('An error occurred while trying to leave the club. Please try again.');
            if (leaveBtn) {
                leaveBtn.disabled = false;
                leaveBtn.innerHTML = '<i class="fas fa-sign-out-alt"></i> Leave {{ club.name }}';
            }
        });
    }
</script>

{% endblock %}